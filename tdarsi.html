  
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سامانه جامع تقویم آموزشی | نسخه پیشرفته</title>
    
    <!-- کتابخانه‌های ضروری -->
    <script src="https://cdn.jsdelivr.net/npm/jalaali-js/dist/jalaali.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #2563eb; --primary-hover: #1d4ed8;
            --bg-app: #f8fafc; --surface: #ffffff;
            --text-main: #1e293b; --text-sub: #64748b;
            --border: #e2e8f0; --radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Vazirmatn', sans-serif; }

        body { background-color: var(--bg-app); color: var(--text-main); padding-bottom: 80px; }

        .app-container {
            max-width: 1400px; margin: 30px auto; padding: 0 20px;
            display: grid; grid-template-columns: 380px 1fr; gap: 25px;
        }

        /* پنل کناری */
        .sidebar {
            background: var(--surface); padding: 25px; border-radius: var(--radius);
            box-shadow: var(--shadow); position: sticky; top: 20px; height: fit-content;
            max-height: 95vh; overflow-y: auto; border: 1px solid var(--border);
        }

        .section-title {
            font-size: 1.1rem; font-weight: 800; color: var(--primary);
            border-bottom: 2px solid var(--border); padding-bottom: 10px; margin: 25px 0 15px;
        }
        .section-title:first-child { margin-top: 0; }

        /* فرم‌ها */
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; font-size: 0.9rem; font-weight: 600; margin-bottom: 5px; color: var(--text-sub); }
        .form-input, .form-select {
            width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px;
            font-size: 0.95rem; transition: 0.2s; background: var(--bg-app);
        }
        .form-input:focus { border-color: var(--primary); outline: none; background: #fff; }
        .row-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

        /* چک‌باکس‌ها */
        .checkbox-group {
            display: flex; flex-direction: column; gap: 8px; background: var(--bg-app);
            padding: 12px; border-radius: 8px; border: 1px solid var(--border);
        }
        .checkbox-item { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; cursor: pointer; }
        .checkbox-item input { accent-color: var(--primary); width: 16px; height: 16px; }

        /* دکمه‌ها */
        .btn {
            width: 100%; padding: 12px; border-radius: 8px; border: none; cursor: pointer;
            font-weight: 700; font-size: 0.95rem; transition: 0.2s; display: flex;
            align-items: center; justify-content: center; gap: 8px; margin-bottom: 10px;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-hover); }
        .btn-success { background: #10b981; color: white; }
        .btn-success:hover { background: #059669; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-danger:hover { background: #dc2626; }
        .btn-sm { padding: 8px; font-size: 0.85rem; }

        /* پنل اصلی */
        .main-content {
            background: var(--surface); padding: 25px; border-radius: var(--radius);
            box-shadow: var(--shadow); min-height: 80vh; border: 1px solid var(--border);
        }

        /* جدول */
        .preview-wrapper { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; white-space: nowrap; }
        th { background: var(--primary); color: white; padding: 12px; text-align: center; }
        td { border: 1px solid var(--border); padding: 8px 12px; text-align: center; }
        
        /* رنگ‌بندی ردیف‌ها */
        .row-holiday { background: #fef2f2; color: #991b1b; font-weight: bold; }
        .row-friday { background: #fce7f3; color: #831843; }
        .row-inter { background: #fff7ed; color: #9a3412; }
        .row-exam { background: #eff6ff; color: #1e40af; }
        .row-event { background: #f0fdf4; color: #166534; }

        /* لیست رویدادها */
        .event-list { max-height: 200px; overflow-y: auto; margin-bottom: 10px; }
        .event-item {
            background: #fff; border: 1px solid var(--border); padding: 8px;
            border-radius: 6px; margin-bottom: 5px; display: flex;
            justify-content: space-between; align-items: center; font-size: 0.85rem;
        }

        /* لیست بین‌التعطیلین */
        #interHolidayList {
            background: #fff7ed; padding: 10px; border-radius: 8px; border: 1px solid #fed7aa;
            margin-bottom: 15px; display: none;
        }
        .inter-item { display: flex; align-items: center; gap: 8px; padding: 5px 0; border-bottom: 1px solid #fed7aa; }
        .inter-item:last-child { border: none; }

        @media (max-width: 900px) { .app-container { grid-template-columns: 1fr; } }
        
        /* استایل مخفی PDF */
        #pdf-source { padding: 20px; background: white; display: none; width: 100%; }
        #pdf-source table { font-size: 10pt; width: 100%; }
        #pdf-source th, #pdf-source td { border: 1px solid #000; padding: 4px; }
    </style>
</head>
<body>

<div class="app-container">
    
    <!-- سایدبار تنظیمات -->
    <aside class="sidebar">
        <h2 style="text-align:center; color:var(--primary); font-weight:900; margin-bottom:20px;">تنظیمات تقویم</h2>

        <div class="section-title">۱. مشخصات تقویم</div>
        <div class="form-group">
            <label class="form-label">عنوان اصلی</label>
            <input type="text" id="calTitle" class="form-input" value="تقویم آموزشی نیمسال اول">
        </div>
        <div class="form-group">
            <label class="form-label">زیرعنوان</label>
            <input type="text" id="calSub" class="form-input" value="سال تحصیلی ۱۴۰۴-۱۴۰۳">
        </div>
        <div class="form-group row-2">
            <div>
                <label class="form-label">شروع (Y/M/D)</label>
                <input type="text" id="startDate" class="form-input" placeholder="1403/07/01" style="text-align:center">
            </div>
            <div>
                <label class="form-label">پایان (Y/M/D)</label>
                <input type="text" id="endDate" class="form-input" placeholder="1403/10/30" style="text-align:center">
            </div>
        </div>

        <div class="section-title">۲. قوانین تعطیلات</div>
        <div class="checkbox-group">
            <label class="checkbox-item">
                <input type="checkbox" id="chkFriday" checked> جمعه‌ها تعطیل باشد
            </label>
            
            <label class="form-label" style="margin-top:10px;">وضعیت پنج‌شنبه‌ها:</label>
            <select id="thursdayMode" class="form-select">
                <option value="work">روز کاری</option>
                <option value="off">کاملاً تعطیل</option>
                <option value="odd_off">هفته‌های فرد تعطیل</option>
                <option value="even_off">هفته‌های زوج تعطیل</option>
            </select>

            <label class="checkbox-item" style="margin-top:10px;">
                <input type="checkbox" id="chkOfficial" checked> تعطیلات رسمی (تقویم) اعمال شود
            </label>
        </div>

        <div class="section-title">۳. مدیریت بین‌التعطیلین</div>
        <button class="btn btn-primary btn-sm" onclick="findInterHolidays()">
            <i class="fas fa-search"></i> جستجوی هوشمند
        </button>
        <div id="interHolidayList">
            <div style="display:flex; justify-content:space-between; margin-bottom:5px; font-weight:bold;">
                <span>لیست پیشنهادی:</span>
                <label style="font-size:0.8rem;"><input type="checkbox" onchange="toggleAllInter(this)"> انتخاب همه</label>
            </div>
            <div id="interItems"></div>
        </div>

        <div class="section-title">۴. رویدادهای دستی</div>
        <div style="background:#f1f5f9; padding:10px; border-radius:8px; border:1px solid var(--border);">
            <div class="form-group row-2">
                <input type="text" id="evtStart" class="form-input" placeholder="شروع (1403/08/10)" style="text-align:center">
                <input type="text" id="evtEnd" class="form-input" placeholder="پایان (اختیاری)" style="text-align:center">
            </div>
            <div class="form-group">
                <input type="text" id="evtDesc" class="form-input" placeholder="عنوان (مثلاً: اردوی علمی)">
            </div>
            <div class="form-group row-2">
                <select id="evtType" class="form-select">
                    <option value="holiday">تعطیل اضطراری</option>
                    <option value="exam">امتحان</option>
                    <option value="event">مناسبت/رویداد</option>
                </select>
                <button class="btn btn-success btn-sm" style="margin:0;" onclick="addEvent()">افزودن</button>
            </div>
        </div>
        <div id="eventList" class="event-list"></div>

        <div class="section-title">۵. خروجی</div>
        <button class="btn btn-primary" onclick="renderPreview()">
            <i class="fas fa-sync"></i> به‌روزرسانی جدول
        </button>
        <button class="btn btn-success" onclick="exportExcel()">
            <i class="fas fa-file-excel"></i> دانلود اکسل (Pro)
        </button>
        <button class="btn btn-danger" onclick="exportPDF()">
            <i class="fas fa-file-pdf"></i> دانلود PDF (استاندارد)
        </button>
    </aside>

    <!-- پنل اصلی -->
    <main class="main-content">
        <div id="previewArea" class="preview-wrapper">
            <div style="text-align:center; padding:50px; color:var(--text-sub);">
                <i class="fas fa-calendar-alt fa-3x" style="margin-bottom:15px; display:block;"></i>
                <h3>لطفاً بازه زمانی را تنظیم و دکمه "به‌روزرسانی" را بزنید.</h3>
            </div>
        </div>
    </main>
</div>

<!-- کانتینر مخفی برای PDF -->
<div id="pdf-source"></div>

<script>
    // --- دیتابیس مناسبت‌ها و تعطیلات رسمی (بدون نیاز به اینترنت) ---
    // فرمت: "ماه-روز": { title: "عنوان", isHoliday: true/false }
    const calendarEvents = {
        "1-1": { title: "عید نوروز", isHoliday: true },
        "1-2": { title: "عید نوروز", isHoliday: true },
        "1-3": { title: "عید نوروز", isHoliday: true },
        "1-4": { title: "عید نوروز", isHoliday: true },
        "1-12": { title: "روز جمهوری اسلامی", isHoliday: true },
        "1-13": { title: "روز طبیعت", isHoliday: true },
        "2-12": { title: "روز معلم", isHoliday: false },
        "3-14": { title: "رحلت امام خمینی", isHoliday: true },
        "3-15": { title: "قیام ۱۵ خرداد", isHoliday: true },
        "11-22": { title: "پیروزی انقلاب اسلامی", isHoliday: true },
        "12-29": { title: "ملی شدن صنعت نفت", isHoliday: true }
        // می‌توانید سایر مناسبت‌های ملی/مذهبی ثابت شمسی را اینجا اضافه کنید
    };

    let customEvents = [];
    let interHolidays = [];

    // --- توابع کمکی تاریخ ---
    function parseDate(str) {
        if(!str) return null;
        const p = str.split('/').map(Number);
        if(p.length !== 3 || isNaN(p[0])) return null;
        return { y: p[0], m: p[1], d: p[2] };
    }

    // تبدیل تاریخ شمسی به آبجکت Date جاوااسکریپت (میلادی)
    function jToDate(y, m, d) {
        const g = jalaali.toGregorian(y, m, d);
        return new Date(g.gy, g.gm - 1, g.gd);
    }

    // مقداردهی اولیه با تاریخ امروز
    window.onload = function() {
        const now = new Date();
        const j = jalaali.toJalaali(now);
        const fmt = n => n.toString().padStart(2, '0');
        document.getElementById('startDate').value = `${j.jy}/${fmt(j.jm)}/${fmt(j.jd)}`;
        
        // 3 ماه بعد
        let em = j.jm + 3; let ey = j.jy;
        if(em > 12) { em -= 12; ey++; }
        document.getElementById('endDate').value = `${ey}/${fmt(em)}/${fmt(j.jd)}`;
    };

    // --- مدیریت رویدادهای دستی ---
    function addEvent() {
        const sVal = document.getElementById('evtStart').value;
        const eVal = document.getElementById('evtEnd').value;
        const desc = document.getElementById('evtDesc').value;
        const type = document.getElementById('evtType').value;

        if(!sVal || !desc) return alert("تاریخ شروع و عنوان الزامی است.");
        const s = parseDate(sVal);
        const e = eVal ? parseDate(eVal) : s;

        if(!s || !e) return alert("فرمت تاریخ صحیح نیست.");

        // اعتبارسنجی بازه
        const ms = parseDate(document.getElementById('startDate').value);
        const me = parseDate(document.getElementById('endDate').value);
        if(jToDate(s.y,s.m,s.d) < jToDate(ms.y,ms.m,ms.d) || jToDate(e.y,e.m,e.d) > jToDate(me.y,me.m,me.d)) {
            return alert("تاریخ باید در محدوده تقویم باشد.");
        }

        customEvents.push({ id: Date.now(), start: s, end: e, title: desc, type });
        renderCustomEvents();
        document.getElementById('evtDesc').value = '';
    }

    function removeEvent(id) {
        customEvents = customEvents.filter(x => x.id !== id);
        renderCustomEvents();
    }

    function renderCustomEvents() {
        const div = document.getElementById('eventList');
        div.innerHTML = '';
        customEvents.forEach(ev => {
            let color = ev.type === 'holiday' ? '#fee2e2' : (ev.type==='exam' ? '#eff6ff' : '#fef3c7');
            div.innerHTML += `
                <div class="event-item" style="background:${color}">
                    <span>${ev.title} (${ev.start.y}/${ev.start.m}/${ev.start.d})</span>
                    <i class="fas fa-times" style="cursor:pointer; color:red" onclick="removeEvent(${ev.id})"></i>
                </div>
            `;
        });
    }

    // --- مدیریت بین‌التعطیلین ---
    function findInterHolidays() {
        const list = calculateDays(true); // محاسبه موقت برای یافتن فواصل
        interHolidays = [];
        const container = document.getElementById('interItems');
        container.innerHTML = '';
        
        for(let i=1; i<list.length-1; i++) {
            const prev = list[i-1];
            const curr = list[i];
            const next = list[i+1];

            // اگر روز جاری تعطیل نیست، ولی قبل و بعدش تعطیل است
            if(prev.isHoliday && next.isHoliday && !curr.isHoliday) {
                interHolidays.push({ date: curr.fullDate, id: i });
                container.innerHTML += `
                    <div class="inter-item">
                        <input type="checkbox" class="inter-check" value="${curr.fullDate}" checked>
                        <span>${curr.dayName} ${curr.fullDate}</span>
                    </div>
                `;
            }
        }
        
        if(interHolidays.length > 0) {
            document.getElementById('interHolidayList').style.display = 'block';
        } else {
            alert("هیچ بین‌التعطیلینی یافت نشد.");
            document.getElementById('interHolidayList').style.display = 'none';
        }
    }

    function toggleAllInter(source) {
        document.querySelectorAll('.inter-check').forEach(c => c.checked = source.checked);
    }

    // --- موتور محاسباتی اصلی ---
    function calculateDays(isDryRun = false) {
        const sStr = document.getElementById('startDate').value;
        const eStr = document.getElementById('endDate').value;
        const s = parseDate(sStr);
        const e = parseDate(eStr);
        
        if(!s || !e) return null;

        const startG = jToDate(s.y, s.m, s.d);
        const endG = jToDate(e.y, e.m, e.d);

        if(endG < startG) return null;

        const thMode = document.getElementById('thursdayMode').value;
        const friOff = document.getElementById('chkFriday').checked;
        const offOff = document.getElementById('chkOfficial').checked;

        // لیست بین‌التعطیلین‌های انتخاب شده
        const selectedInter = [];
        if(!isDryRun) {
            document.querySelectorAll('.inter-check:checked').forEach(c => selectedInter.push(c.value));
        }

        let result = [];
        let curr = new Date(startG);
        let session = 1;
        let weekIdx = 1;

        const weekNames = ['یکشنبه', 'دوشنبه', 'سه‌شنبه', 'چهارشنبه', 'پنج‌شنبه', 'جمعه', 'شنبه'];
        const monthNames = ['', 'فروردین', 'اردیبهشت', 'خرداد', 'تیر', 'مرداد', 'شهریور', 'مهر', 'آبان', 'آذر', 'دی', 'بهمن', 'اسفند'];

        while(curr <= endG) {
            const j = jalaali.toJalaali(curr);
            const wd = curr.getDay(); // 0..6
            const dateKey = `${j.jm}-${j.jd}`; // برای مناسبت ثابت
            const fullDate = `${j.jy}/${j.jm}/${j.jd}`;

            let row = {
                idx: 0,
                dayName: weekNames[wd],
                fullDate: fullDate,
                monthName: monthNames[j.jm],
                status: 'آموزشی',
                reason: '',
                session: '',
                isHoliday: false,
                css: ''
            };

            // 1. بررسی رویدادهای دستی کاربر (اولویت بالا)
            for(let ev of customEvents) {
                const es = jToDate(ev.start.y, ev.start.m, ev.start.d);
                const ee = jToDate(ev.end.y, ev.end.m, ev.end.d);
                if(curr >= es && curr <= ee) {
                    row.reason = ev.title;
                    if(ev.type === 'holiday') { row.isHoliday = true; row.status = 'تعطیل'; row.css = 'row-holiday'; }
                    else if(ev.type === 'exam') { row.status = 'امتحان'; row.css = 'row-exam'; }
                    else { row.status = 'رویداد'; row.css = 'row-event'; } // رویداد غیر تعطیل
                }
            }

            // 2. بررسی بین‌التعطیلین (اگر دستی تنظیم نشده بود)
            if(!row.isHoliday && selectedInter.includes(fullDate)) {
                row.isHoliday = true;
                row.status = 'تعطیل';
                row.reason = 'بین‌التعطیلین';
                row.css = 'row-inter';
            }

            // 3. بررسی جمعه
            if(!row.isHoliday && wd === 5 && friOff) {
                row.isHoliday = true;
                row.status = 'تعطیل';
                row.reason = 'جمعه';
                row.css = 'row-friday';
            }

            // 4. بررسی پنج‌شنبه
            if(!row.isHoliday && wd === 4) {
                if(thMode === 'off') { row.isHoliday = true; row.reason = 'تعطیل پنج‌شنبه'; row.css = 'row-holiday'; }
                else if(thMode === 'odd_off' && weekIdx % 2 !== 0) { row.isHoliday = true; row.reason = 'تعطیل هفته فرد'; row.css = 'row-holiday'; }
                else if(thMode === 'even_off' && weekIdx % 2 === 0) { row.isHoliday = true; row.reason = 'تعطیل هفته زوج'; row.css = 'row-holiday'; }
            }

            // 5. بررسی مناسبت‌های تقویم (ثابت)
            // نکته: مناسبت‌ها همیشه نمایش داده می‌شوند، اما تعطیلی‌شان شرطی است
            if(calendarEvents[dateKey]) {
                const evt = calendarEvents[dateKey];
                // اگر توضیحات خالی است، پر شود. اگر پر است، اضافه شود.
                row.reason = row.reason ? row.reason + " - " + evt.title : evt.title;
                
                if(evt.isHoliday && offOff && !row.isHoliday) {
                    row.isHoliday = true;
                    row.status = 'تعطیل';
                    row.css = 'row-holiday';
                }
            }

            // شمارش جلسه
            if(!row.isHoliday && row.status !== 'امتحان') {
                row.session = session++;
            } else {
                row.session = '-';
            }
            if(row.isHoliday) row.status = 'تعطیل';

            result.push(row);

            if(wd === 5) weekIdx++;
            curr.setDate(curr.getDate() + 1);
        }
        return result;
    }

    // --- 5. پیش‌نمایش و خروجی‌ها ---
    function renderPreview() {
        const data = calculateDays();
        if(!data) return alert("بازه زمانی نامعتبر است.");

        const title = document.getElementById('calTitle').value;
        const sub = document.getElementById('calSub').value;

        let html = `
            <div style="text-align:center; margin-bottom:20px;">
                <h2 style="color:#1e40af; margin:0;">${title}</h2>
                <h4 style="color:#64748b; margin:5px 0;">${sub}</h4>
            </div>
            <table>
                <thead>
                    <tr>
                        <th width="5%">#</th>
                        <th width="10%">روز</th>
                        <th width="15%">تاریخ</th>
                        <th width="10%">ماه</th>
                        <th width="10%">وضعیت</th>
                        <th width="40%">مناسبت / توضیحات</th>
                        <th width="10%">جلسه</th>
                    </tr>
                </thead>
                <tbody>
        `;

        data.forEach((r, i) => {
            html += `
                <tr class="${r.css}">
                    <td>${i + 1}</td>
                    <td>${r.dayName}</td>
                    <td dir="ltr">${r.fullDate}</td>
                    <td>${r.monthName}</td>
                    <td><strong>${r.status}</strong></td>
                    <td style="text-align:right;">${r.reason}</td>
                    <td><strong>${r.session}</strong></td>
                </tr>
            `;
        });
        html += `</tbody></table>`;

        document.getElementById('previewArea').innerHTML = html;
        document.getElementById('pdf-source').innerHTML = html; // برای PDF
    }

    async function exportExcel() {
        const data = calculateDays();
        if(!data) return;

        const wb = new ExcelJS.Workbook();
        const ws = wb.addWorksheet('تقویم', {views: [{rightToLeft: true}]});

        // هدر
        ws.mergeCells('A1:G1');
        const t = ws.getCell('A1');
        t.value = document.getElementById('calTitle').value;
        t.font = { name: 'Tahoma', size: 16, bold: true, color: { argb: 'FFFFFFFF' } };
        t.fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FF1E40AF' } };
        t.alignment = { horizontal: 'center', vertical: 'middle' };

        ws.mergeCells('A2:G2');
        const s = ws.getCell('A2');
        s.value = document.getElementById('calSub').value;
        s.font = { name: 'Tahoma', size: 12, bold: true };
        s.alignment = { horizontal: 'center', vertical: 'middle' };

        // سرستون
        const hRow = ws.getRow(3);
        hRow.values = ['ردیف', 'روز', 'تاریخ', 'ماه', 'وضعیت', 'توضیحات', 'جلسه'];
        hRow.eachCell(cell => {
            cell.fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FF2563EB' } };
            cell.font = { name: 'Tahoma', size: 11, bold: true, color: { argb: 'FFFFFFFF' } };
            cell.alignment = { horizontal: 'center', vertical: 'middle' };
            cell.border = { top: {style:'thin'}, left: {style:'thin'}, bottom: {style:'thin'}, right: {style:'thin'} };
        });

        // داده‌ها
        data.forEach((d, i) => {
            const r = ws.addRow([i+1, d.dayName, d.fullDate, d.monthName, d.status, d.reason, d.session]);
            let bg = 'FFFFFFFF';
            if(d.css === 'row-holiday' || d.css === 'row-friday') bg = 'FFFEE2E2';
            if(d.css === 'row-inter') bg = 'FFFFEDD5';
            if(d.css === 'row-exam') bg = 'FFEFF6FF';

            r.eachCell(c => {
                c.fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: bg } };
                c.border = { top: {style:'thin'}, left: {style:'thin'}, bottom: {style:'thin'}, right: {style:'thin'} };
                c.alignment = { horizontal: 'center', vertical: 'middle' };
                c.font = { name: 'Tahoma' };
            });
        });

        ws.columns = [ {width:6}, {width:12}, {width:15}, {width:12}, {width:15}, {width:45}, {width:8} ];

        const buf = await wb.xlsx.writeBuffer();
        saveAs(new Blob([buf]), 'Calendar.xlsx');
    }

    function exportPDF() {
        const el = document.getElementById('pdf-source');
        if(!el.innerHTML) renderPreview();
        el.style.display = 'block';
        
        html2pdf().set({
            margin: 0.5,
            filename: 'Calendar.pdf',
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
        }).from(el).save().then(() => el.style.display = 'none');
    }
</script>

</body>
</html>
