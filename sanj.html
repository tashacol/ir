   <!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex, nofollow">
    <title>استعلام گواهی آموزشی</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700;800&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <script src="https://www.google.com/recaptcha/api.js?render=6Lc1vqkrAAAAAHLHbzPMzlREvKwgHDNSmakrB-aq"></script>

    <style>
        :root {
            --font-main: 'Vazirmatn', sans-serif; --primary-color: #1e3a8a; --secondary-color: #3b82f6;
            --text-dark: #111827; --text-light: #6b7280; --bg-glass: rgba(255, 255, 255, 0.8); 
            --border-glass: rgba(255, 255, 255, 0.9); --shadow-light: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
            --radius: 20px; --transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
            --success-color: #16a34a; --warning-color: #f59e0b; --error-color: #dc2626;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: var(--font-main); background-image: url('https://tashacol.ir/1l5jlse9 (1).jpeg');
            background-size: cover; background-position: center center; background-repeat: no-repeat;
            background-attachment: fixed; color: var(--text-dark); display: flex; justify-content: center;
            align-items: flex-start; min-height: 100vh; padding: 40px 20px;
        }
        .container { width: 100%; max-width: 600px; opacity: 0; transform: translateY(20px); animation: fadeInSlideUp 0.8s 0.3s forwards cubic-bezier(0.165, 0.84, 0.44, 1); }
        @keyframes fadeInSlideUp { to { opacity: 1; transform: translateY(0); } }
        .header-logo { display: block; margin: 0 auto 30px auto; width: 100px; height: auto; }
        .search-box { background: var(--bg-glass); padding: 40px; border-radius: var(--radius); box-shadow: var(--shadow-light); backdrop-filter: blur(10px); border: 1px solid var(--border-glass); margin-bottom: 2rem; transition: var(--transition); }
        h1 { font-size: 2rem; font-weight: 800; text-align: center; margin-bottom: 2.5rem; color: var(--text-dark); display: flex; align-items: center; justify-content: center; gap: 15px; }
        h1 .fa-award { color: var(--primary-color); font-size: 1.8rem; }
        .input-container { position: relative; width: 100%; margin-bottom: 1.5rem; }
        #searchInput { width: 100%; padding: 14px 45px 14px 16px; font-size: 1.1rem; font-family: 'Vazirmatn', sans-serif; border: 1px solid var(--border-glass); border-radius: 12px; outline: none; transition: var(--transition); text-align: center; letter-spacing: 3px; background-color: rgba(255, 255, 255, 0.8); }
        .input-container .fa-id-card { position: absolute; top: 50%; right: 15px; transform: translateY(-50%); font-size: 1.2rem; color: #a9aeb4; transition: color 0.2s; }
        #searchInput::placeholder { color: #a9aeb4; letter-spacing: normal; }
        #searchInput:focus { border-color: var(--secondary-color); background-color: #fff; box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2); }
        #searchInput:focus + .fa-id-card { color: var(--secondary-color); }
        #searchButton { position: relative; width: 100%; padding: 12px; font-size: 1.1rem; font-weight: 700; font-family: 'Vazirmatn', sans-serif; background: var(--primary-color); color: #fff; border: none; border-radius: 12px; cursor: pointer; transition: var(--transition); height: 50px; display: flex; align-items: center; justify-content: center; }
        #searchButton .fa-search { color: #fff; margin-left: 10px; }
        #searchButton:hover:not(:disabled) { transform: translateY(-3px); background: var(--secondary-color); box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4); }
        #searchButton:disabled { background: #9ca3af; cursor: not-allowed; }
        .btn-loader { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 24px; height: 24px; border: 3px solid rgba(255, 255, 255, 0.4); border-top-color: #fff; border-radius: 50%; animation: spin 0.8s linear infinite; display: none; }
        #searchButton.loading .btn-text-content { opacity: 0; }
        #searchButton.loading .btn-loader { display: block; }
        @keyframes spin { to { transform: translate(-50%, -50%) rotate(360deg); } }
        #errorMsg { color: var(--error-color); text-align: center; margin-top: 1rem; font-size: 0.9rem; display: none; min-height: 20px; font-weight: 500; }
        #resultsContainer { transition: opacity 0.5s; }
        .result-card { background: var(--bg-glass); border-radius: var(--radius); box-shadow: var(--shadow-light); border: 1px solid var(--border-glass); backdrop-filter: blur(10px); overflow: hidden; animation: popInResult 0.6s ease-out; }
        @keyframes popInResult { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .card-header { padding: 1.5rem; background: rgba(30, 58, 138, 0.1); border-bottom: 1px solid var(--border-glass); color: var(--text-dark); }
        .card-header h2 { margin: 0; font-size: 1.5rem; font-weight: 700; display: flex; align-items: center; }
        .card-header h2 .fa-user-circle { color: var(--primary-color); font-size: 1.8rem; margin-left: 12px; }
        .card-header p { margin: 0.25rem 0 0; font-size: 1rem; color: var(--text-light); }
        .card-body { padding: 1.5rem; }
        .info-list { list-style: none; padding: 0; margin: 0; }
        .info-item { display: flex; align-items: center; padding: 1rem 0; border-bottom: 1px solid rgba(226, 232, 240, 0.7); }
        .info-item:last-child { border-bottom: none; }
        .info-item .fas { font-size: 1.1rem; color: var(--secondary-color); width: 30px; }
        .info-label { color: var(--text-light); font-size: 0.9rem; margin-right: 0.5rem; }
        .info-value { color: var(--text-dark); font-weight: 700; font-size: 1rem; margin-right: auto; }
        .card-footer { display: flex; gap: 1rem; padding: 1.5rem; background-color: rgba(248, 250, 252, 0.8); border-top: 1px solid var(--border-glass); flex-wrap: wrap; }
        .result-button { flex: 1 1 150px; text-decoration: none; color: #fff; padding: 12px 20px; border-radius: 12px; text-align: center; font-weight: 700; font-size: 1rem; transition: var(--transition); display: flex; justify-content: center; align-items: center; gap: 0.6rem; }
        .result-button:hover { transform: translateY(-3px); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2); }
        .result-button.project { background-color: var(--success-color); }
        .result-button.certificate { background-color: var(--warning-color); color: var(--text-dark); }
    </style>
</head>
<body>

    <div class="container">
        <img src="https://tashacol.ir/1754843708220.png" alt="لوگوی موسسه تعالی" class="header-logo">
        <div class="search-box">
            <h1><i class="fas fa-award"></i>استعلام گواهی آموزشی</h1>
            <div class="input-container">
                 <input type="text" id="searchInput" placeholder="کد ملی خود را وارد کنید" inputmode="numeric" maxlength="10" />
                 <i class="fas fa-id-card"></i>
            </div>
            <button id="searchButton">
                <span class="btn-text-content">
                    <i class="fas fa-search"></i>
                    <span class="btn-text">استعلام</span>
                </span>
                <div class="btn-loader"></div>
            </button>
            <div id="errorMsg"></div>
        </div>
        <div id="resultsContainer"></div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxPqmsSM8Thob9k7tJap0F9UokZkMRAVEdwIa9cbdUIEg4pkPqmmxGQD8-gwZGw0mHJ2Q/exec';
        const RECAPTCHA_SITE_KEY = '6Lc1vqkrAAAAAHLHbzPMzlREvKwgHDNSmakrB-aq';

        const input = document.getElementById('searchInput');
        const btn = document.getElementById('searchButton');
        const errorMsg = document.getElementById('errorMsg');
        const resultsContainer = document.getElementById('resultsContainer');
        const btnTextContent = btn.querySelector('.btn-text-content');

        const toggleLoading = (isLoading) => { btn.classList.toggle('loading', isLoading); btnTextContent.style.opacity = isLoading ? '0' : '1'; btn.disabled = isLoading; };
        const showError = (message) => { errorMsg.textContent = message; errorMsg.style.display = 'block'; };
        const resetUI = () => { resultsContainer.innerHTML = ''; errorMsg.style.display = 'none'; };

        btn.addEventListener('click', () => {
            resetUI();
            const nationalIdInput = input.value.trim();
            if (!/^\d{10}$/.test(nationalIdInput)) { showError('کد ملی باید 10 رقم و فقط شامل عدد باشد.'); return; }
            toggleLoading(true);

            grecaptcha.ready(() => {
                grecaptcha.execute(RECAPTCHA_SITE_KEY, { action: 'submit' }).then(async (recaptchaToken) => {
                    try {
                        const tokenResponse = await requestSessionToken(nationalIdInput, recaptchaToken);
                        if (tokenResponse.error) throw new Error(tokenResponse.message);
                        if (!tokenResponse.success) {
                             showError('اطلاعاتی با این کد ملی یافت نشد. لطفا مجددا تلاش کنید.');
                             toggleLoading(false);
                             return;
                        }
                        const dataResponse = await fetchDataWithToken(tokenResponse.token);
                        if (dataResponse.error) throw new Error(dataResponse.message);
                        if (dataResponse.found) displayResults(dataResponse);
                        else throw new Error(dataResponse.message || 'خطای ناشناخته در دریافت اطلاعات.');
                    } catch (err) {
                        showError(err.message || 'یک خطای غیرمنتظره رخ داد. لطفاً اتصال اینترنت خود را بررسی کنید.');
                    } finally {
                        toggleLoading(false);
                    }
                });
            });
        });

        async function requestSessionToken(nationalId, recaptchaToken) {
            // *** تغییر کلیدی در اینجا ***
            // داده‌ها با استفاده از URLSearchParams ارسال می‌شوند که روش استاندارد و قوی‌تری است.
            const formData = new URLSearchParams();
            formData.append('nationalId', nationalId);
            formData.append('recaptchaToken', recaptchaToken);

            const response = await fetch(SCRIPT_URL, {
                method: 'POST',
                body: formData
            });

            if (!response.ok) throw new Error('خطا در ارتباط با سرور.');
            return response.json();
        }

        async function fetchDataWithToken(token) {
            const url = `${SCRIPT_URL}?action=getData&token=${token}`;
            const response = await fetch(url);
            if (!response.ok) throw new Error('خطا در بارگذاری اطلاعات از سرور.');
            return response.json();
        }
        
        input.addEventListener('keypress', (event) => { if (event.key === 'Enter') { event.preventDefault(); btn.click(); } });

        function displayResults(data) {
            const fallbackText = 'ثبت نشده';
            const name = data.name || fallbackText, courseName = data.courseName || fallbackText, nationalId = data.nationalId || fallbackText;
            const courseCode = data.courseCode || fallbackText, issueDate = data.issueDate || fallbackText, certificateNumber = data.certificateNumber || fallbackText;
            const projectLink = data.projectLink, certificateLink = data.certificateLink;

            let footerButtons = '';
            if (projectLink && projectLink.toString().trim() !== '') footerButtons += `<a href="${projectLink.toString().trim()}" target="_blank" class="result-button project"><i class="fas fa-download"></i>دانلود پروژه</a>`;
            if (certificateLink && certificateLink.toString().trim() !== '') footerButtons += `<a href="${certificateLink.toString().trim()}" target="_blank" class="result-button certificate"><i class="fas fa-check-circle"></i>دانلود گواهینامه</a>`;

            const cardHTML = `
                <div class="result-card">
                    <div class="card-header">
                        <h2><i class="fas fa-user-circle"></i>${name}</h2> <p>${courseName}</p>
                    </div>
                    <div class="card-body">
                        <ul class="info-list">
                            <li class="info-item"><i class="fas fa-id-card"></i><span class="info-label">کد ملی:</span><span class="info-value">${nationalId}</span></li>
                            <li class="info-item"><i class="fas fa-award"></i><span class="info-label">شماره گواهی:</span><span class="info-value">${certificateNumber}</span></li>
                            <li class="info-item"><i class="fas fa-book-open"></i><span class="info-label">کد دوره:</span><span class="info-value">${courseCode}</span></li>
                            <li class="info-item"><i class="fas fa-calendar-alt"></i><span class="info-label">تاریخ صدور:</span><span class="info-value">${issueDate}</span></li>
                        </ul>
                    </div>
                    ${footerButtons ? `<div class="card-footer">${footerButtons}</div>` : ''}
                </div>`;
            resultsContainer.innerHTML = cardHTML;
        }
    </script>
</body>
</html>
