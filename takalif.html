<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø¨Ø±Ø³ÛŒ Ùˆ Ø§Ø±Ø³Ø§Ù„ ØªÚ©Ø§Ù„ÛŒÙ</title>
  <!-- Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ xlsx Ø¬Ù‡Øª Ø®ÙˆØ§Ù†Ø¯Ù† Ø§Ú©Ø³Ù„ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
  <style>
    /* --- Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡ Ùˆ Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ --- */
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Arial', sans-serif;
      /* Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ù…Ø¯Ø±Ù† Ø¨Ù‡ ØµÙˆØ±Øª ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡ Ø¨Ø§ Ú¯Ø±Ø§Ø¯ÛŒÙ†Øª Ø¢Ø¨ÛŒ */
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      background-repeat: no-repeat;
      background-size: cover;
      background-attachment: fixed;
      margin: 0;
      padding: 20px;
      direction: rtl;
      text-align: center;
      color: #333;
      min-height: 100vh;
    }
    h2 {
      margin-bottom: 20px;
      color: #fff;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    /* --- Ø§Ø³ØªØ§ÛŒÙ„ Ø¨Ø®Ø´ Ø¨Ø±Ø±Ø³ÛŒ ØªÚ©Ø§Ù„ÛŒÙ --- */
    .input-box {
      margin-bottom: 20px;
    }
    .input-box input {
      width: 250px;
      padding: 10px;
      /* Ù…Ø¯Ø±Ù† Ú©Ø±Ø¯Ù† ÙÛŒÙ„Ø¯: Ø­Ø°Ù Ø­Ø§Ø´ÛŒÙ‡ Ùˆ Ø§ÙØ²ÙˆØ¯Ù† Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ù…Ù„Ø§ÛŒÙ… */
      border: none;
      border-radius: 12px;
      background-color: #f0f0f0;
      box-shadow: inset 2px 2px 5px rgba(0,0,0,0.1);
      transition: background-color 0.3s, box-shadow 0.3s;
      direction: rtl;
      text-align: center;
    }
    .input-box input:focus {
      background-color: #fff;
      box-shadow: 0 2px 8px rgba(0,123,255,0.3);
      outline: none;
    }
    /* Ø§ØµÙ„Ø§Ø­ Ø¯Ú©Ù…Ù‡ Ø¬Ø³ØªØ¬Ùˆ: Ø­Ø°Ù Ø­Ø§Ø´ÛŒÙ‡ Ùˆ Ø³Ø§ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ Ùˆ Ø¸Ø§Ù‡Ø± Ù…Ø¯Ø±Ù† */
    .input-box button {
      margin-left: 10px;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      background-color: #007bff;
      color: #fff;
      cursor: pointer;
      transition: background-color 0.2s, transform 0.2s;
      font-size: 14px;
    }
    .input-box button:hover {
      background-color: #0056b3;
      transform: translateY(-2px);
    }
    /* --- Ø§Ø³ØªØ§ÛŒÙ„ Ø¨Ø§Ú©Ø³â€ŒÙ‡Ø§ÛŒ ØªØ±Ù… --- */
    .term-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }
    .term-box {
      background-color: #fff;
      border-radius: 16px;
      padding: 15px;
      width: 150px;
      border: 1px solid rgba(0,0,0,0.1);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
      text-align: center;
    }
    .term-box:hover {
      transform: translateY(-8px) scale(1.02);
      border-color: rgba(0,0,0,0.2);
      box-shadow: 0 10px 20px rgba(0,0,0,0.25);
    }
    .term-box strong {
      display: block;
      margin-bottom: 10px;
      font-size: 16px;
    }
    .term-box button {
      margin-top: 10px;
      padding: 8px 12px;
      border: none;
      border-radius: 8px;
      background: linear-gradient(145deg, #ffffff, #e6e6e6);
      box-shadow: 4px 4px 8px rgba(0,0,0,0.1), -4px -4px 8px #ffffff;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      font-size: 13px;
    }
    .term-box button:hover {
      transform: translateY(-3px);
      box-shadow: 2px 2px 6px rgba(0,0,0,0.15), -2px -2px 6px #ffffff;
    }
    /* --- Ø§Ø³ØªØ§ÛŒÙ„ Ù†Ø´Ø§Ù† ÙˆØ¶Ø¹ÛŒØª ØªÚ©Ù„ÛŒÙ --- */
    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: bold;
      color: #fff;
    }
    .status-checking {
      background-color: #b58900; /* Ø²Ø±Ø¯ ØªÛŒØ±Ù‡ */
    }
    .status-approved {
      background-color: #4caf50; /* Ø³Ø¨Ø² */
    }
    .status-rejected {
      background-color: #c62828; /* Ù‚Ø±Ù…Ø² ØªÛŒØ±Ù‡ */
    }
    .status-not-sent {
      background-color: #9e9e9e;
    }
    /* --- Ù„Ø§ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø§Ù¾â€ŒØ¢Ù¾ (Overlay) --- */
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease;
      z-index: 1000;
    }
    .overlay.active {
      opacity: 1;
      visibility: visible;
    }
    /* --- Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªÚ©Ù„ÛŒÙ --- */
    .popup-view {
      position: fixed;
      top: 50%;
      left: 50%;
      width: 320px;
      max-width: 90%;
      background-color: #fff;
      border-radius: 16px;
      padding: 20px;
      margin: 20px auto;
      transform: translate(-50%, -50%);
      border: 1px solid rgba(0,0,0,0.1);
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
      z-index: 1001;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
      text-align: center;
    }
    .popup-view.active {
      opacity: 1;
      visibility: visible;
      transform: translate(-50%, -50%) scale(1.01);
    }
    .popup-view h3 {
      margin-top: 0;
      font-size: 18px;
    }
    .popup-view p {
      background-color: #f9f9f9;
      padding: 10px;
      border-radius: 8px;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
      user-select: text;
      text-align: right;
      margin-bottom: 15px;
      white-space: pre-wrap;
      word-wrap: break-word;
      max-height: 60vh;
      overflow-y: auto;
    }
    .popup-buttons {
      display: flex;
      justify-content: space-between;
      gap: 10px;
    }
    .icon-button {
      flex: 1;
      padding: 8px;
      border: none;
      border-radius: 8px;
      background: linear-gradient(145deg, #ffffff, #e6e6e6);
      box-shadow: 4px 4px 8px rgba(0,0,0,0.1), -4px -4px 8px #ffffff;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
    }
    .icon-button:hover {
      transform: translateY(-3px);
      box-shadow: 2px 2px 6px rgba(0,0,0,0.15), -2px -2px 6px #ffffff;
    }
    .close-button {
      margin-top: 15px;
      padding: 10px;
      border: none;
      border-radius: 8px;
      background: linear-gradient(145deg, #ffffff, #e6e6e6);
      box-shadow: 4px 4px 8px rgba(0,0,0,0.1), -4px -4px 8px #ffffff;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      font-size: 14px;
    }
    .close-button:hover {
      transform: translateY(-3px);
      box-shadow: 2px 2px 6px rgba(0,0,0,0.15), -2px -2px 6px #ffffff;
    }
    /* --- Ù¾Ø§Ù¾â€ŒØ¢Ù¾ ÙØ±Ù… Ø§Ø±Ø³Ø§Ù„ ØªÚ©Ø§Ù„ÛŒÙ --- */
    .popup-form {
      position: fixed;
      top: 50%;
      left: 50%;
      width: 360px;
      max-width: 90%;
      background-color: #fff;
      border-radius: 16px;
      padding: 25px;
      margin: 20px auto;
      transform: translate(-50%, -50%);
      border: 1px solid rgba(0,0,0,0.1);
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
      z-index: 1001;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
      text-align: center;
    }
    .popup-form.active {
      opacity: 1;
      visibility: visible;
      transform: translate(-50%, -50%) scale(1.01);
    }
    .popup-form .form-title {
      font-size: 20px;
      font-weight: bold;
      color: #00796b;
      margin-bottom: 20px;
      text-align: center;
    }
    .popup-form form label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #00796b;
      text-align: center;
    }
    .popup-form form textarea {
      width: 100%;
      padding: 12px;
      min-height: 100px;
      /* Ù…Ø¯Ø±Ù† Ú©Ø±Ø¯Ù† ÙÛŒÙ„Ø¯: Ø­Ø°Ù Ø­Ø§Ø´ÛŒÙ‡ Ùˆ Ø§ÙØ²ÙˆØ¯Ù† Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ù…Ù„Ø§ÛŒÙ… */
      border: none;
      border-radius: 12px;
      background-color: #f0f0f0;
      box-shadow: inset 2px 2px 5px rgba(0,0,0,0.1);
      transition: background-color 0.3s, box-shadow 0.3s;
      resize: vertical;
      font-size: 14px;
      direction: rtl;
      text-align: right;
    }
    .popup-form form textarea:focus {
      background-color: #fff;
      box-shadow: 0 2px 8px rgba(255,235,59,0.5);
      outline: none;
    }
    .popup-form form button[type="submit"] {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 8px;
      background: linear-gradient(145deg, #ffffff, #e6e6e6);
      box-shadow: 4px 4px 8px rgba(0,0,0,0.1), -4px -4px 8px #ffffff;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      font-size: 14px;
      margin-top: 10px;
    }
    .popup-form form button[type="submit"]:hover {
      transform: translateY(-3px);
      box-shadow: 2px 2px 6px rgba(0,0,0,0.15), -2px -2px 6px #ffffff;
    }
    /* --- ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù…Ø®ÙÛŒ --- */
    .popup-form input[type="hidden"] {
      display: none;
    }
    /* --- Ù„ÙˆØ¯Ø± Ù‡Ù†Ú¯Ø§Ù… Ø§Ø±Ø³Ø§Ù„ ØªÚ©Ø§Ù„ÛŒÙ --- */
    .loader {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3498db;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
      display: inline-block;
      vertical-align: middle;
      margin-left: 10px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    /* --- Toast Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… (Ú©Ù¾ÛŒ ØªÚ©Ù„ÛŒÙ) --- */
    #toast {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #323232;
      color: #fff;
      padding: 12px 24px;
      border-radius: 8px;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.5s ease, visibility 0.5s ease;
      z-index: 1100;
      font-size: 14px;
    }
    #toast.show {
      opacity: 1;
      visibility: visible;
    }
    /* --- Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø§Ø®Ø·Ø§Ø± Ú©Ø¯ Ù…Ù„ÛŒ (Ø¬Ø°Ø§Ø¨ Ùˆ Ù…Ø¯Ø±Ù†) --- */
    #warningOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease;
      z-index: 1000;
    }
    #warningOverlay.active {
      opacity: 1;
      visibility: visible;
    }
    #warningPopup {
      position: fixed;
      top: 50%;
      left: 50%;
      width: 300px;
      max-width: 90%;
      background-color: #fff;
      border-radius: 16px;
      padding: 20px;
      transform: translate(-50%, -50%);
      box-shadow: 0 10px 20px rgba(0,0,0,0.15);
      z-index: 1001;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, transform 0.3s ease;
      text-align: center;
    }
    #warningPopup.active {
      opacity: 1;
      visibility: visible;
    }
    #warningPopup h3 {
      margin-top: 0;
      font-size: 18px;
      color: #c62828;
    }
    #warningPopup p {
      font-size: 16px;
      margin: 10px 0;
      color: #333;
    }
    #warningPopup button {
      margin-top: 10px;
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      background-color: #c62828;
      color: #fff;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    #warningPopup button:hover {
      background-color: #a41c1c;
    }
  </style>
</head>
<body>
  <!-- Ø¨Ø®Ø´ Ø¨Ø±Ø±Ø³ÛŒ ØªÚ©Ø§Ù„ÛŒÙ Ø¯Ø§Ù†Ø´Ø¬Ùˆ -->
  <div class="container">
    <h2>Ø¨Ø±Ø³ÛŒ Ùˆ Ø§Ø±Ø³Ø§Ù„ ØªÚ©Ø§Ù„ÛŒÙ</h2>
    <div class="input-box" id="inputBox">
      <input type="text" id="nationalCodeInput" placeholder="Ú©Ø¯ Ù…Ù„ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" />
      <button onclick="fetchData()">Ø¨Ø±Ø±Ø³ÛŒ</button>
    </div>
    <div id="result" class="term-container"></div>
  </div>

  <!-- Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªÚ©Ù„ÛŒÙ -->
  <div id="assignmentOverlay" class="overlay" onclick="closeAssignmentPopup()"></div>
  <div id="assignmentPopup" class="popup-view">
    <h3>Ù…ØªÙ† ØªÚ©Ù„ÛŒÙ</h3>
    <p id="assignmentText"></p>
    <div class="popup-buttons">
      <button class="icon-button" onclick="copyAssignmentText()">
        <!-- Ø¢ÛŒÚ©Ù† Ú©Ù¾ÛŒ -->
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#fff" viewBox="0 0 16 16">
          <path d="M13 1H3a2 2 0 0 0-2 2v10h1V3a1 1 0 0 1 1-1h10V1z"/>
          <path d="M14 4H6a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zm0 11H6V6h8v9z"/>
        </svg>
        Ú©Ù¾ÛŒ
      </button>
      <button class="icon-button" onclick="printAssignmentText()">
        <!-- Ø¢ÛŒÚ©Ù† Ú†Ø§Ù¾ -->
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#fff" viewBox="0 0 16 16">
          <path d="M2 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V7zm1 0v4h10V7H3z"/>
          <path d="M5 0a2 2 0 0 0-2 2v2h10V2a2 2 0 0 0-2-2H5z"/>
          <path d="M11 9H5v3h6V9z"/>
        </svg>
        Ú†Ø§Ù¾
      </button>
    </div>
    <button class="close-button" onclick="closeAssignmentPopup()">Ø¨Ø³ØªÙ†</button>
  </div>

  <!-- Ù¾Ø§Ù¾â€ŒØ¢Ù¾ ÙØ±Ù… Ø§Ø±Ø³Ø§Ù„ ØªÚ©Ø§Ù„ÛŒÙ -->
  <div id="formOverlay" class="overlay"></div>
  <div id="formPopup" class="popup-form">
    <div id="formPopupMessage"></div>
    <form onsubmit="submitForm(event)">
      <div class="form-title">Ø§Ø±Ø³Ø§Ù„ ØªÚ©Ø§Ù„ÛŒÙ</div>
      <!-- ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù…Ø®ÙÛŒ -->
      <input type="hidden" id="formName" name="name" />
      <input type="hidden" id="formNationalCode" name="nationalCode" />
      <input type="hidden" id="formCourseNumber" name="courseNumber" />
      <!-- ØªÙ†Ù‡Ø§ ÙÛŒÙ„Ø¯ ØªÚ©Ù„ÛŒÙ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
      <label for="formAssignment"> </label>
      <textarea id="formAssignment" name="assignment" required placeholder="Ù…ØªÙ† ØªÚ©Ù„ÛŒÙ Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯"></textarea>
      <button type="submit">Ø§Ø±Ø³Ø§Ù„ ØªÚ©Ø§Ù„ÛŒÙ</button>
    </form>
    <button class="close-button" onclick="closeFormPopup()">Ø¨Ø³ØªÙ†</button>
  </div>

  <!-- Toast Ù¾ÛŒØ§Ù… (Ø¨Ø±Ø§ÛŒ Ú©Ù¾ÛŒ ØªÚ©Ù„ÛŒÙ) --->
  <div id="toast"></div>

  <!-- Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø§Ø®Ø·Ø§Ø± Ú©Ø¯ Ù…Ù„ÛŒ --->
  <div id="warningOverlay" class="overlay" onclick="closeWarningPopup()"></div>
  <div id="warningPopup">
    <h3>Ù‡Ø´Ø¯Ø§Ø±</h3>
    <p id="warningMessage"></p>
    <button onclick="closeWarningPopup()">ØªØ§ÛŒÛŒØ¯</button>
  </div>

  <!-- Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ -->
  <div id="welcomeOverlay" class="overlay" onclick="closeWelcomePopup()"></div>
  <div id="welcomePopup" class="popup-view">
    <h3>ğŸ‘‡</h3>
    <p id="welcomeText">ÙØ±Ø§Ú¯ÛŒØ± Ú¯Ø±Ø§Ù…ÛŒØŒ Ù„Ø·ÙØ§ Ø®Ù„Ø§ØµÙ‡ Ø§ÛŒ Ú©Ø§Ù…Ù„ Ùˆ Ø¯Ø§Ø±Ø§ÛŒ ØªÙ…Ø§Ù… Ù†Ú©Ø§Øª Ù…Ù‡Ù… Ø§Ø² ØªÙ…Ø§Ù… ÙØµÙ„â€ŒÙ‡Ø§ÛŒ Ù‡Ø± ØªØ±Ù… Ø§Ø±Ø³Ø§Ù„ Ø¨ÙØ±Ù…Ø§ÛŒÛŒØ¯. Ù„Ø·ÙØ§ Ø¹Ù†ÙˆØ§Ù† Ù‡Ø± ÙØµÙ„ Ø±Ø§ Ø¯Ø± Ø®Ø·ÛŒ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ù†ÙˆØ´ØªÙ‡ Ùˆ Ø²ÛŒØ± Ø¢Ù† Ù…ØªÙ† ØªÚ©Ù„ÛŒÙ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯. Ø¨Ù‡ØªØ± Ø§Ø³Øª ØªÚ©Ù„ÛŒÙ Ø±Ø§ Ø¯Ø± ÛŒØ§Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§ ÛŒØ§ ÙˆØ±Ø¯ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯ Ùˆ Ø³Ù¾Ø³ Ú©Ù¾ÛŒ Ù†Ù…ÙˆØ¯Ù‡ Ùˆ Ø¯Ø± Ù‚Ø³Ù…Øª Ø§Ø±Ø³Ø§Ù„ ØªÚ©Ø§Ù„ÛŒÙ Ø¬Ø§ÛŒâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù†Ù…Ø§ÛŒÛŒØ¯. </p>
    <button class="close-button" onclick="closeWelcomePopup()">Ø¨Ø³ØªÙ†</button>
  </div>

  <!-- Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ù„ÙˆØ¯Ø± Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¨Ù‡ Ù…Ø¯Øª Û³ Ø«Ø§Ù†ÛŒÙ‡ Ù¾Ø³ Ø§Ø² Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ø¯Ø¯ -->
  <div id="loadingOverlay" class="overlay">
    <div class="popup-view" style="width: auto; padding: 20px;">
      <h3>ØªÚ©Ø§Ù„ÛŒÙ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø³Øª</h3>
      <div class="loader"></div>
    </div>
  </div>

  <script>
    // Ù…ØªØºÛŒØ± Ø³Ø±Ø§Ø³Ø±ÛŒ Ø¬Ù‡Øª Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ú©Ø³Ù„ ØªÚ©Ø§Ù„ÛŒÙ
    let excelData = [];
    // Ù…ØªØºÛŒØ± Ø³Ø±Ø§Ø³Ø±ÛŒ Ø¬Ù‡Øª Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ú©Ø³Ù„ Ø«Ø¨Øª Ù†Ø§Ù…
    let registrationData = [];

    async function loadExcel() {
      const url = "https://docs.google.com/spreadsheets/d/1XF4pEc5pAKAFQFo2EInBrgLgu7uJBgQlv5U-mVCw8KE/export?format=xlsx";
      try {
        const response = await fetch(url);
        const data = await response.arrayBuffer();
        const workbook = XLSX.read(data, { type: "array" });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        excelData = XLSX.utils.sheet_to_json(sheet, { header: 1 });
      } catch (error) {
        console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ú©Ø³Ù„:", error);
      }
    }

    async function loadRegistrationExcel() {
      const regUrl = "https://docs.google.com/spreadsheets/d/1QSRAGajWtCWHJHsU-u4dRW85nq2hCGySKqtZQL0iTjY/export?format=xlsx";
      try {
        const response = await fetch(regUrl);
        const data = await response.arrayBuffer();
        const workbook = XLSX.read(data, { type: "array" });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        registrationData = XLSX.utils.sheet_to_json(sheet, { header: 1 });
      } catch (error) {
        console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ú©Ø³Ù„ Ø«Ø¨Øª Ù†Ø§Ù…:", error);
      }
    }

    // ØªÙˆÙ„ÛŒØ¯ Ù†Ø´Ø§Ù† ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§ Ø¢ÛŒÚ©Ù† Ùˆ Ø±Ù†Ú¯ Ù…Ù†Ø§Ø³Ø¨
    function generateStatusBadge(status) {
      if (status === "ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡") {
        return `<span class="status-badge status-approved">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#fff" viewBox="0 0 16 16">
            <path d="M13.485 1.929a.75.75 0 0 1 0 1.06L6.06 10.414a.75.75 0 0 1-1.06 0L2.515 7.93a.75.75 0 0 1 1.06-1.06L6 8.293l6.424-6.424a.75.75 0 0 1 1.061 0z"/>
          </svg>
          ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡
        </span>`;
      } else if (status === "Ø±Ø¯ Ø´Ø¯Ù‡") {
        return `<span class="status-badge status-rejected">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#fff" viewBox="0 0 16 16">
            <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
          </svg>
          Ø±Ø¯ Ø´Ø¯Ù‡
        </span>`;
      } else if (status === "Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ") {
        return `<span class="status-badge status-checking">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#fff" viewBox="0 0 16 16">
            <path d="M8 3.5a.5.5 0 0 1 .5.5v4l2.5 1.5a.5.5 0 0 1-.5.866l-3-1.8A.5.5 0 0 1 7.5 8V4a.5.5 0 0 1 .5-.5z"/>
            <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm0-1A7 7 0 1 1 8 1a7 7 0 0 1 0 14z"/>
          </svg>
          Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ
        </span>`;
      } else {
        return `<span class="status-badge status-not-sent">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#fff" viewBox="0 0 16 16">
            <path d="M8 3.5a.5.5 0 0 1 .5.5v4l2.5 1.5a.5.5 0 0 1-.5.866l-3-1.8A.5.5 0 0 1 7.5 8V4a.5.5 0 0 1 .5-.5z"/>
            <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm0-1A7 7 0 1 1 8 1a7 7 0 0 1 0 14z"/>
          </svg>
          Ø§Ø±Ø³Ø§Ù„ Ù†Ø´Ø¯Ù‡
        </span>`;
      }
    }

    // Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ùˆ Ù†Ù…Ø§ÛŒØ´ ØªØ±Ù…â€ŒÙ‡Ø§
    function fetchData() {
      const nationalCode = document.getElementById("nationalCodeInput").value.trim();
      if (!nationalCode) {
        showWarningPopup("Ù„Ø·ÙØ§Ù‹ Ú©Ø¯ Ù…Ù„ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯");
        return;
      }
      // Ø¨Ø±Ø±Ø³ÛŒ ØµØ­Øª Ø«Ø¨Øª Ù†Ø§Ù…: Ú†Ú© Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ø¢ÛŒØ§ Ú©Ø¯ Ù…Ù„ÛŒ Ø¯Ø± Ø§Ú©Ø³Ù„ Ø«Ø¨Øª Ù†Ø§Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª ÛŒØ§ Ø®ÛŒØ±
      const registeredUser = registrationData.find(row => row[1] == nationalCode);
      if (!registeredUser) {
        showWarningPopup("Ø§Ø±Ø³Ø§Ù„ ØªÚ©Ø§Ù„ÛŒÙ Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§ Ù…Ø¬Ø§Ø² Ù†ÛŒØ³Øª");
        return;
      }
      document.getElementById("inputBox").classList.add("hidden");
      const resultContainer = document.getElementById("result");
      resultContainer.innerHTML = "";
      let userAssignments = excelData.filter(row => row[1] == nationalCode);
      for (let term = 1; term <= 8; term++) {
        let termBox = document.createElement("div");
        termBox.classList.add("term-box");
        let userTermData = userAssignments.find(row => row[2] == term);
        let status = "Ø§Ø±Ø³Ø§Ù„ Ù†Ø´Ø¯Ù‡";
        let buttonHTML = "";
        if (userTermData) {
          if (userTermData[4] === 1) {
            status = "ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡";
          } else if (userTermData[4] === 0) {
            status = "Ø±Ø¯ Ø´Ø¯Ù‡";
            buttonHTML = `<button onclick="editAssignment()">ÙˆÛŒØ±Ø§ÛŒØ´</button>`;
          } else {
            status = "Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ";
          }
          buttonHTML += `<button onclick='showAssignmentPopup(${JSON.stringify(userTermData[3])})'>Ù…Ø´Ø§Ù‡Ø¯Ù‡</button>`;
        } else {
          buttonHTML += `<button onclick="sendAssignment(${term}, '${nationalCode}')">Ø§Ø±Ø³Ø§Ù„ ØªÚ©Ù„ÛŒÙ</button>`;
        }
        termBox.innerHTML = `<strong>ØªØ±Ù… ${term}</strong><br>${generateStatusBadge(status)}<br>${buttonHTML}`;
        resultContainer.appendChild(termBox);
      }
    }

    // Ù†Ù…Ø§ÛŒØ´ Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªÚ©Ù„ÛŒÙ
    function showAssignmentPopup(text) {
      // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² innerHTML Ø¨Ù‡ Ø¬Ø§ÛŒ innerText Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù…ØªÙˆÙ† Ø·ÙˆÙ„Ø§Ù†ÛŒ Ùˆ ÙØ±Ù…Øªâ€ŒØ¨Ù†Ø¯ÛŒ Ø´Ø¯Ù‡
      document.getElementById("assignmentText").innerHTML = text;
      document.getElementById("assignmentOverlay").classList.add("active");
      document.getElementById("assignmentPopup").classList.add("active");
    }
    function closeAssignmentPopup() {
      document.getElementById("assignmentOverlay").classList.remove("active");
      document.getElementById("assignmentPopup").classList.remove("active");
    }
    // Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¯Ú©Ù…Ù‡ Ú©Ù¾ÛŒ (Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ÛŒÚ© ÙÛŒÙ„Ø¯ Ù…ÙˆÙ‚Øª Ø¬Ù‡Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ)
    function copyAssignmentText() {
      const text = document.getElementById("assignmentText").innerText;
      const textarea = document.createElement("textarea");
      textarea.value = text;
      document.body.appendChild(textarea);
      textarea.select();
      try {
        const successful = document.execCommand('copy');
        if (successful) {
          showToast("Ù…ØªÙ† ØªÚ©Ù„ÛŒÙ Ú©Ù¾ÛŒ Ø´Ø¯.");
        } else {
          showToast("Ú©Ù¾ÛŒ Ù†Ø´Ø¯ØŒ Ù„Ø·ÙØ§Ù‹ Ø¯Ø³ØªÛŒ Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯.");
        }
      } catch (err) {
        showToast("Ú©Ù¾ÛŒ Ø¨Ø§ Ø®Ø·Ø§ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯.");
      }
      document.body.removeChild(textarea);
    }
    // Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¯Ú©Ù…Ù‡ Ú†Ø§Ù¾ Ø¨Ø§ ØªÙ†Ø¸ÛŒÙ… Ø¬Ù‡Øª Ø±Ø§Ø³Øª Ø¨Ù‡ Ú†Ù¾
    function printAssignmentText() {
      const printWindow = window.open('', '', 'width=600,height=400');
      printWindow.document.write(`
        <html>
          <head>
            <style>
              body { 
                direction: rtl; 
                text-align: right; 
                font-family: Arial, sans-serif; 
                padding: 20px;
              }
              pre { white-space: pre-wrap; word-wrap: break-word; }
            </style>
          </head>
          <body>
            <pre>${document.getElementById("assignmentText").innerText}</pre>
          </body>
        </html>
      `);
      printWindow.document.close();
      printWindow.print();
    }
    function editAssignment() {
      alert("Ø§Ù…Ú©Ø§Ù† ÙˆÛŒØ±Ø§ÛŒØ´ ØªÚ©Ù„ÛŒÙ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± ÙØ¹Ø§Ù„ Ù†ÛŒØ³Øª.");
    }
    // Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ ÙØ±Ù… Ø§Ø±Ø³Ø§Ù„ ØªÚ©Ø§Ù„ÛŒÙ (Ù¾Ø± Ú©Ø±Ø¯Ù† ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù…Ø®ÙÛŒ)
    function sendAssignment(term, nationalCode) {
      let student = registrationData.find(row => row[1] == nationalCode);
      let studentName = student ? student[0] : "";
      document.getElementById("formName").value = studentName;
      document.getElementById("formNationalCode").value = nationalCode;
      document.getElementById("formCourseNumber").value = term;
      document.getElementById("formAssignment").value = "";
      document.getElementById("formOverlay").classList.add("active");
      document.getElementById("formPopup").classList.add("active");
      document.getElementById("formPopupMessage").style.display = "none";
    }
    // Ø§Ø±Ø³Ø§Ù„ ÙØ±Ù… ØªÚ©Ø§Ù„ÛŒÙ Ø¨Ø§ Ù†Ù…Ø§ÛŒØ´ Ù„ÙˆØ¯ÛŒÙ†Ú¯ Ùˆ Ø³Ù¾Ø³ Ù†ØªÛŒØ¬Ù‡
    async function submitForm(event) {
      event.preventDefault();
      const form = event.target;
      const formData = new FormData(form);
      showFormMessage("Ù„Ø·ÙØ§Ù‹ ØµØ¨Ø± Ú©Ù†ÛŒØ¯...");
      try {
        const response = await fetch("https://script.google.com/macros/s/AKfycbw921Yc3saJgymfvsl0zwyz7wkuNCdSkmTHpjUfFyOMb-rYKYaXaaL9d9_H6T5dMByv2g/exec", {
          method: "POST",
          body: formData
        });
        const result = await response.text();
        showFormMessage(result);
        // Ø°Ø®ÛŒØ±Ù‡ Ú©Ø¯ Ù…Ù„ÛŒ ÙØ¹Ù„ÛŒ Ù‚Ø¨Ù„ Ø§Ø² Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ù…Ø¬Ø¯Ø¯ ØµÙØ­Ù‡
        localStorage.setItem("nationalCode", document.getElementById("formNationalCode").value);
        setTimeout(closeFormPopup, 3000);
        setTimeout(() => {
          window.location.reload();
        }, 3500);
      } catch (error) {
        console.error("Ø®Ø·Ø§:", error);
        showFormMessage("Ø§ØªØµØ§Ù„ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯");
        setTimeout(closeFormPopup, 3000);
      }
    }
    function showFormMessage(message) {
      const msgDiv = document.getElementById("formPopupMessage");
      msgDiv.innerText = message;
      if(message.indexOf("ØµØ¨Ø± Ú©Ù†ÛŒØ¯") !== -1) {
        msgDiv.innerHTML += `<span class="loader"></span>`;
      }
      msgDiv.style.display = "block";
    }
    function closeFormPopup() {
      document.getElementById("formOverlay").classList.remove("active");
      document.getElementById("formPopup").classList.remove("active");
    }
    // Ù†Ù…Ø§ÛŒØ´ Toast Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ù…ÙˆÙ‚Øª
    function showToast(message) {
      const toast = document.getElementById("toast");
      toast.innerText = message;
      toast.classList.add("show");
      setTimeout(() => {
        toast.classList.remove("show");
      }, 2000);
    }
    // Ù†Ù…Ø§ÛŒØ´ Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø§Ø®Ø·Ø§Ø± Ú©Ø¯ Ù…Ù„ÛŒ
    function showWarningPopup(message) {
      document.getElementById("warningMessage").innerText = message;
      document.getElementById("warningOverlay").classList.add("active");
      document.getElementById("warningPopup").classList.add("active");
    }
    function closeWarningPopup() {
      document.getElementById("warningOverlay").classList.remove("active");
      document.getElementById("warningPopup").classList.remove("active");
    }
    // Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ
    function showWelcomePopup(){
      document.getElementById("welcomeOverlay").classList.add("active");
      document.getElementById("welcomePopup").classList.add("active");
    }
    function closeWelcomePopup(){
      document.getElementById("welcomeOverlay").classList.remove("active");
      document.getElementById("welcomePopup").classList.remove("active");
    }
    // ØªÙˆØ§Ø¨Ø¹ Ù†Ù…Ø§ÛŒØ´ Ùˆ Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† Ù„ÙˆØ¯Ø±
    function showLoadingOverlay(){
      document.getElementById("loadingOverlay").classList.add("active");
    }
    function hideLoadingOverlay(){
      document.getElementById("loadingOverlay").classList.remove("active");
    }
    window.onload = function() {
      const storedNationalCode = localStorage.getItem("nationalCode");
      if(storedNationalCode) {
        document.getElementById("nationalCodeInput").value = storedNationalCode;
        showLoadingOverlay();
        setTimeout(() => {
          hideLoadingOverlay();
          fetchData();
          localStorage.removeItem("nationalCode");
        }, 3000);
      } else {
        showWelcomePopup();
      }
    }
    loadExcel();
    loadRegistrationExcel();
  </script>
</body>
</html>
