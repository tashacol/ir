<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1200">
    <title>پرتال اساتید قرآن کریم</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --font-main: 'Vazirmatn', sans-serif;
            --primary-color: #0c4a6e; --secondary-color: #075985; --accent-color: #38bdf8;
            --light-bg: #f8fafc; --container-bg: #ffffff; --dark-text: #1e293b; --light-text: #64748b;
            --border-color: #e2e8f0; --danger-color: #dc2626; --success-color: #16a34a; --warning-color: #f59e0b;
        }
        body {
            font-family: var(--font-main);
            color: var(--dark-text);
            line-height: 1.7;
            min-width: 1200px;
            margin: 0;
            background-image: url('https://tashacol.ir/1l5jlse9 (1).jpeg');
            background-size: cover;
            background-position: center center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            transition: opacity 0.2s linear; /* For flicker effect */
        }
        .hidden { display: none !important; }

        /*  استایل صفحه ورود */
        #login-container { display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 20px; }
        #login-section { text-align: center; max-width: 420px; width: 100%; background: var(--container-bg); padding: 40px; border-radius: 16px; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.05), 0 10px 10px -5px rgba(0,0,0,0.04); }
        .login-header-icon {
            max-width: 120px;
            height: auto;
            margin-bottom: 20px;
            display: inline-block;
        }
        #login-form button[type="submit"] { width: 100%; }
        .container { max-width: 1100px; margin: 40px auto; } /* کانتینر برای داشبورد */
        
        h1, h2, h3, h4 { color: var(--primary-color); text-align: center; font-weight: 700; }
        h1 { font-size: 2.2rem; margin-bottom: 30px;} h2 { font-size: 1.8rem; border-bottom: 2px solid var(--border-color); padding-bottom: 15px; margin-bottom: 30px; }
        h4 { font-size: 1.3rem; color: var(--secondary-color); margin-bottom: 15px; }

        .form-group { margin-bottom: 20px; position: relative; } 
        label { display: block; margin-bottom: 8px; font-weight: bold; font-size: 1rem; text-align: right; }
        input, select { text-align: center; width: 100%; box-sizing: border-box; padding: 12px 15px; border: 1px solid #a8b3c2; border-radius: 8px; font-size: 1rem; font-family: var(--font-main); transition: all 0.3s; }
        input:focus, select:focus { border-color: var(--secondary-color); box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.3); outline: none; }
        
        button { text-decoration: none; position:relative; background-color: var(--secondary-color); color: white; padding: 12px 30px; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; font-family: var(--font-main); transition: all 0.3s; display: inline-block; text-align: center; }
        button:hover:not(:disabled) { background-color: var(--primary-color); transform: translateY(-2px); }
        
        /* --- START: PROFESSIONAL GLITCH & FLICKER EFFECTS --- */
        .glitch-effect {
            animation: glitch-jump-anim 0.4s steps(2, jump-none) infinite;
        }

        @keyframes glitch-jump-anim {
            0%, 100% { transform: translate(0, 0); clip-path: inset(0); }
            10% { transform: translate(-3px, 2px); clip-path: inset(80vh 0 10vh 0); }
            10.1% { transform: translate(0, 0); clip-path: inset(0); }
            40% { transform: translate(2px, -3px); clip-path: inset(20vh 0 50vh 0); }
            40.1% { transform: translate(0, 0); clip-path: inset(0); }
            75% { transform: translate(-4px, -1px); clip-path: inset(5vh 0 90vh 0); }
            75.1% { transform: translate(0, 0); clip-path: inset(0); }
        }

        .flicker-effect {
            animation: flicker-anim 2s linear infinite;
        }

        @keyframes flicker-anim {
            0% { opacity: 1; }
            50% { opacity: 0.9; }
            52% { opacity: 1; }
            70% { opacity: 0.95; }
            73% { opacity: 1; }
            90% { opacity: 0.85; }
            92% { opacity: 1; }
        }
        
        #lightning {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            z-index: 9999;
            pointer-events: none;
            display: none;
        }

        #system-failure-message {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #000;
            color: #fff;
            font-size: 3rem;
            font-family: 'Courier New', Courier, monospace;
            text-align: center;
            z-index: 10000;
        }
        /* --- END: PROFESSIONAL GLITCH & FLICKER EFFECTS --- */

        /* Other styles remain the same... */
        .hidden { display: none !important; }
        .input-icon { position: absolute; top: 43px; right: 15px; color: var(--light-text); font-size: 1.3rem; }
        input.has-icon { padding-right: 45px; }
        .btn-loading .btn-text { visibility: hidden; }
        .btn-loading::after { content: ''; position: absolute; width: 20px; height: 20px; top: 0; left: 0; right: 0; bottom: 0; margin: auto; border: 3px solid transparent; border-top-color: #ffffff; border-radius: 50%; animation: button-loading-spinner 1s ease infinite; }
        @keyframes button-loading-spinner { from { transform: rotate(0turn); } to { transform: rotate(1turn); } }
        .dashboard-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding: 15px; background-color: rgba(255,255,255,0.8); backdrop-filter: blur(5px); border-radius: 12px; }
        .header-actions { display: flex; align-items: center; gap: 10px; }
        .icon-btn { background: none; border: none; color: var(--light-text); cursor: pointer; display: inline-flex; align-items: center; gap: 8px; font-size: 0.9rem; font-family: var(--font-main); padding: 8px; border-radius: 8px; transition: all 0.3s; }
        .icon { width: 1em; height: 1em; vertical-align: middle; }
    </style>
</head>
<body>
    <svg width="0" height="0" class="hidden">
        <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="icon-id-card"><path fill="currentColor" d="M20 4H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2M4 6h16v2H4zm8 12H4v-7h8zm-1-4a2 2 0 1 1 0-4a2 2 0 0 1 0 4m7 4h-5v-2h5zm0-3h-5v-2h5z"></path></symbol>
        <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="icon-lock"><path fill="currentColor" d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m-6 9c-1.1 0-2-.9-2-2s.9-2 2-2s2 .9 2 2s-.9 2-2 2M9 8V6c0-1.66 1.34-3 3-3s3 1.34 3 3v2z"></path></symbol>
        <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="icon-email"><path fill="currentColor" d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4l-8 5l-8-5V6l8 5l8-5z"></path></symbol>
        <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="icon-logout"><path fill="currentColor" d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4z"></path></symbol>
    </svg>
    
    <div id="login-container">
        <div id="login-section">
            <img src="https://tashacol.ir/quran.png" alt="لوگو" class="login-header-icon">
            <h1>پرتال اساتید قرآن کریم</h1>
            <form id="login-form" onsubmit="handleManualLogin(event)">
                <div class="form-group">
                    <label for="nationalId">کد ملی</label>
                    <div class="input-icon"><svg class="icon"><use href="#icon-id-card"></use></svg></div>
                    <input type="tel" inputmode="numeric" pattern="[0-9]*" id="nationalId" required class="has-icon">
                </div>
                <div class="form-group">
                    <label for="password">رمز عبور</label>
                    <div class="input-icon"><svg class="icon"><use href="#icon-lock"></use></svg></div>
                    <input type="password" id="password" required class="has-icon">
                </div>
                <button type="submit"><span class="btn-text">ورود</span></button>
                <p id="error-message" class="hidden" style="color:var(--danger-color); margin-top: 15px;"></p>
            </form>
        </div>
    </div>
    
    <div id="dashboard-section" class="hidden">
        <div class="container">
            <div class="dashboard-header">
                <div id="welcome-message" style="font-size: 1.5rem;"></div>
                <div class="header-actions">
                    <button id="edit-email-btn" class="icon-btn"><svg class="icon" style="color:var(--accent-color);"><use href="#icon-email"></use></svg><span class="btn-text">ویرایش ایمیل</span></button>
                    <button id="logout-btn" class="icon-btn" style="color:var(--danger-color);"><svg class="icon"><use href="#icon-logout"></use></svg><span class="btn-text">خروج</span></button>
                </div>
            </div>
            <div id="content-placeholder">محتوای داشبورد در اینجا قرار می‌گیرد...</div>
        </div>
    </div>
    
    <div id="modal-container"></div>
    <div id="lightning"></div>
<script>
    // Variables for fake API calls, session etc.
    const SCRIPT_URL = "YOUR_APPS_SCRIPT_URL"; // This is just a placeholder
    const sessionKey = 'quranTeacherSession';
    let loggedInInstructorId = null, loggedInInstructorName = null, loggedInInstructorEmail = null;

    // --- START: PROFESSIONAL GLITCH & FLICKER SCRIPT ---
    
    // Store timeout IDs to be able to clear them all
    let effectTimeouts = [];

    // Function to stop all running visual effects
    function stopAllEffects() {
        effectTimeouts.forEach(clearTimeout);
        effectTimeouts = [];
        document.body.classList.remove('glitch-effect', 'flicker-effect');
        const lightning = document.getElementById('lightning');
        if (lightning) lightning.style.display = 'none';
    }

    // Function to start the effects with different intensity levels
    function startEffects(intensity = 'low') {
        stopAllEffects(); // Clear any previous effects before starting new ones

        // --- Flicker effect logic ---
        const startFlicker = () => {
            document.body.classList.add('flicker-effect');
        };

        // --- Glitch effect logic ---
        const triggerGlitch = () => {
            const glitchDuration = 80 + Math.random() * 150; // Glitch lasts for a very short, random time
            document.body.classList.add('glitch-effect');

            const t1 = setTimeout(() => {
                document.body.classList.remove('glitch-effect');
            }, glitchDuration);

            // Schedule the next glitch at a random interval
            const nextGlitchDelay = (intensity === 'low')
                ? 3000 + Math.random() * 5000 // 3-8 seconds for low intensity
                : 1000 + Math.random() * 2500; // 1-3.5 seconds for high
            const t2 = setTimeout(triggerGlitch, nextGlitchDelay);
            effectTimeouts.push(t1, t2);
        };

        // --- Lightning effect logic (only for high intensity) ---
        const triggerLightning = () => {
            if (intensity !== 'high') return;

            const lightningEl = document.getElementById('lightning');
            lightningEl.style.display = 'block';
            const t1 = setTimeout(() => {
                lightningEl.style.display = 'none';
            }, 70); // A very quick flash

            const nextLightningDelay = 4000 + Math.random() * 6000; // 4-10 seconds
            const t2 = setTimeout(triggerLightning, nextLightningDelay);
            effectTimeouts.push(t1, t2);
        };

        // --- Start the sequences with initial delays ---
        const flickerDelay = (intensity === 'low') ? 2500 : 1500;
        const glitchDelay = (intensity === 'low') ? 4000 : 2000;
        const lightningDelay = 3000;

        effectTimeouts.push(setTimeout(startFlicker, flickerDelay));
        effectTimeouts.push(setTimeout(triggerGlitch, glitchDelay));
        effectTimeouts.push(setTimeout(triggerLightning, lightningDelay));
    }

    function startInitialEffects() {
        startEffects('low');
    }

    function startDashboardChaos() {
        // Start high-intensity effects after a brief moment of calm
        setTimeout(() => startEffects('high'), 2000);

        // Schedule the final system failure after a while
        const t1 = setTimeout(() => {
            showSystemFailure();
        }, 12000); // System crashes after 12 seconds of chaos
        effectTimeouts.push(t1);
    }

    function showSystemFailure() {
        stopAllEffects();
        document.body.innerHTML = '<div id="system-failure-message"><div>مشکل سامانه</div></div>';
        
        let blinkCount = 0;
        const failureMessage = document.querySelector('#system-failure-message div');
        const blinkInterval = setInterval(() => {
            failureMessage.style.visibility = (failureMessage.style.visibility === 'hidden' ? 'visible' : 'hidden');
            blinkCount++;
            if (blinkCount > 8) { // Blink 4 times (8 changes)
                clearInterval(blinkInterval);
                // Redirect after the blinking stops
                window.location.href = "https://google.com";
            }
        }, 400);
    }
    
    // --- END: PROFESSIONAL GLITCH & FLICKER SCRIPT ---

    // --- Helper & Auth Functions ---

    function isValidNationalId(nid) { if (!nid) return false; return /^\d{10}$/.test(nid); }

    document.addEventListener('DOMContentLoaded', () => {
        const savedSession = localStorage.getItem(sessionKey);
        if (savedSession) {
            const { nationalId, name, email } = JSON.parse(savedSession);
            showDashboard(nationalId, name, email);
        } else {
            // If user is not logged in, start the low-intensity effects on the login page
            startInitialEffects();
        }
    });

    function showDashboard(nationalId, name, email) {
        stopAllEffects(); // Stop any login-page effects
        loggedInInstructorId = nationalId; 
        loggedInInstructorName = name;
        loggedInInstructorEmail = email;

        document.getElementById('login-container').classList.add('hidden'); 
        document.getElementById('dashboard-section').classList.remove('hidden');
        document.getElementById('welcome-message').innerHTML = `استاد <strong>${name}</strong>، خوش آمدید.`;
        
        document.getElementById('logout-btn').addEventListener('click', handleLogout);
        
        // Start the chaos sequence for the dashboard
        startDashboardChaos();
    }
    
    async function handleManualLogin(event) {
        event.preventDefault();
        const button = event.target.querySelector('button');
        button.classList.add('btn-loading');
        button.disabled = true;

        const nationalId = document.getElementById('nationalId').value;
        const password = document.getElementById('password').value;
        const errorP = document.getElementById('error-message');
        errorP.classList.add('hidden');

        if (!isValidNationalId(nationalId)) {
            errorP.innerText = "کد ملی باید یک عدد ۱۰ رقمی صحیح باشد.";
            errorP.classList.remove('hidden');
            button.classList.remove('btn-loading');
            button.disabled = false;
            return;
        }

        // --- Fake login check ---
        setTimeout(() => {
            if (nationalId === "1111111111" && password === "1234") {
                const fakeUserData = { nationalId: nationalId, name: "علی محمدی", email: "test@example.com" };
                localStorage.setItem(sessionKey, JSON.stringify(fakeUserData));
                showDashboard(fakeUserData.nationalId, fakeUserData.name, fakeUserData.email);
            } else {
                errorP.innerText = "کد ملی یا رمز عبور اشتباه است.";
                errorP.classList.remove('hidden');
                button.classList.remove('btn-loading');
                button.disabled = false;
            }
        }, 1500); // Simulate network delay
    }

    function handleLogout() {
        stopAllEffects();
        localStorage.removeItem(sessionKey); 
        window.location.reload(); 
    }

</script>
</body>
</html>
