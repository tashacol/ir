<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>جستجوی پیشرفته و OSINT</title>
  <link rel="icon" type="image/png" sizes="40x40" href="https://tashacol.github.io/ir/Icon40.png">
  <link rel="manifest" href="https://tashacol.github.io/ir/serch.json">
  <meta name="apple-mobile-web-app-title" content="جستجو پیشرفته">
  <meta name="application-name" content="جستجو پیشرفته">
  <meta name="theme-color" content="#0072ff">
  <style type="text/css">
    /* ریست و استایل‌های پایه */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Vazirmatn', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      direction: rtl;
      background: #f0f2f5; /* رنگ پس‌زمینه مدرن و خنثی */
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start; /* تغییر برای نمایش بهتر در اسکرول */
      padding: 40px 20px;
    }

    .container {
      background: #ffffff;
      border-radius: 16px;
      padding: 30px 40px;
      max-width: 700px;
      width: 100%;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
      animation: fadeInUp 0.5s ease-out;
      border: 1px solid #e0e0e0;
      margin-bottom: 40px;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    h1 {
      text-align: center;
      color: #1c1e21;
      margin-bottom: 30px;
      font-size: 2.2rem;
      font-weight: 700;
    }

    /* استایل فیلدها و منوهای کشویی مدرن */
    select, input[type="text"] {
      font-size: 1rem;
      width: 100%;
      padding: 12px 16px;
      margin-bottom: 15px;
      border: 1px solid #dddfe2;
      border-radius: 8px;
      outline: none;
      background-color: #f5f6f7;
      text-align: right;
      transition: all 0.3s ease;
    }

    select:focus, input[type="text"]:focus {
      border-color: #0072ff;
      background-color: #ffffff;
      box-shadow: 0 0 0 3px rgba(0, 114, 255, 0.15);
    }
    
    select {
      cursor: pointer;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23606770' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: left 16px center;
    }
    
    /* دکمه اصلی جستجو */
    #searchButton {
      font-size: 1.1rem;
      font-weight: 600;
      width: 100%;
      padding: 14px;
      margin-top: 20px;
      border: none;
      border-radius: 8px;
      background: linear-gradient(90deg, #0072ff, #00c6ff);
      color: #ffffff;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 114, 255, 0.2);
    }

    #searchButton:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0, 114, 255, 0.3);
    }
    
    #searchButton:active {
      transform: translateY(0);
      box-shadow: 0 4px 15px rgba(0, 114, 255, 0.2);
    }
    
    /* دکمه‌های کوچک */
    .add-button, .remove-button {
      width: 40px;
      height: 40px;
      font-size: 1.2rem;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      color: white;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-right: 10px;
      flex-shrink: 0;
    }
    
    .add-button { background-color: #42b72a; }
    .add-button:hover { background-color: #36a420; }
    
    .remove-button { background-color: #fa3e3e; }
    .remove-button:hover { background-color: #e33434; }

    .search-field {
      display: none;
      padding: 20px;
      border: 1px solid #e0e0e0;
      border-radius: 12px;
      background: #fafafa;
      animation: fadeIn 0.4s ease;
      margin-top: 10px;
    }
    
    .exclude-field {
      display: flex;
      align-items: center;
      margin-top: 10px;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.98); }
      to { opacity: 1; transform: scale(1); }
    }

    /* استایل پنل‌های کشویی */
    .collapsible-header {
      cursor: pointer;
      font-weight: 600;
      margin-top: 20px;
      padding: 12px 16px;
      background: #f0f2f5;
      border: 1px solid #dddfe2;
      border-radius: 8px;
      transition: background-color 0.3s, border-radius 0.3s;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .collapsible-header:hover { background-color: #e9ecef; }
    
    .collapsible-container {
      border: 1px solid #dddfe2;
      border-top: none;
      border-radius: 0 0 8px 8px;
      padding: 20px;
      background: #ffffff;
    }
    
    .option-group {
      margin-bottom: 15px;
    }
    
    .option-group h3 {
        color: #0072ff;
        margin-top: 15px;
        margin-bottom: 10px;
        border-bottom: 1px solid #eee;
        padding-bottom: 5px;
        font-size: 1rem;
    }
    .option-group:first-child h3 { margin-top: 0; }
    
    .combine-option { margin-bottom: 15px; }
    
    .combine-option label {
      cursor: pointer;
      font-size: 1rem;
      color: #333;
      display: flex;
      align-items: center;
    }
    .combine-option input[type="checkbox"] { margin-left: 10px; transform: scale(1.2); }
    
    .combine-input {
      margin-top: 8px;
      padding-right: 25px;
      display: none;
      animation: fadeIn 0.3s;
    }
    
    /* استایل تاریخچه جستجو */
    .history {
      margin-top: 30px;
      border-top: 1px solid #e0e0e0;
      padding-top: 20px;
    }
    .history h3 { color: #606770; margin-bottom: 15px; font-size: 1.2rem; }
    .history-item {
      padding: 12px 16px;
      border: 1px solid #dddfe2;
      border-radius: 8px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      background: #f5f6f7;
      display: flex;
      justify-content: space-between;
      align-items: center;
      word-break: break-all;
    }
    .history-item:hover {
      background: #e9ecef;
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    }
    .history-item-text { flex-grow: 1; }
    .history-item .delete-button {
      background-color: #ff4d4d;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 5px 10px;
      font-size: 0.8rem;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.3s;
      margin-right: 10px;
    }
    .history-item:hover .delete-button { opacity: 1; }
  </style>
</head>
<body>

  <div class="container">
    <h1>جستجوی پیشرفته و OSINT</h1>
    
    <select id="searchType" onchange="showSearchField()">
      <option value="simple">نوع اصلی جستجو را انتخاب کنید</option>
      <option value="ppt">پاورپوینت (ppt)</option>
      <option value="pdf">پی دی اف (pdf)</option>
      <option value="docx">ورد (docx)</option>
      <option value="xlsx">اکسل (xlsx)</option>
      <option value="exact">عبارت دقیق ("")</option>
      <option value="title">در تیتر (intitle)</option>
      <option value="inurl">در آدرس (inurl)</option>
      <option value="site">در یک سایت خاص (site)</option>
      <option value="domain">در یک دامنه خاص (site:.*.xx)</option>
      <option value="link">لینک به یک صفحه (link)</option>
      <option value="define">معنی کلمه (define)</option>
      <option value="scholar">گوگل اسکالر (محقق)</option>
    </select>

    <div id="searchContainer" class="search-field">
      <input type="text" id="searchInput" placeholder="عبارت اصلی جستجو..." />
      <div id="domainOptions" style="display:none;">
          <input type="text" id="domainInput" placeholder="دامنه را وارد کنید (مثلا: .edu یا ir)">
      </div>
      <div id="excludeFieldsContainer">
          <div class="exclude-field">
              <input type="text" class="excludeInput" placeholder="این کلمات جستجو نشوند..." />
              <button class="add-button" onclick="addExcludeField()">+</button>
          </div>
      </div>
    </div>

    <div id="combineWrapper">
      <div id="combineHeader" class="collapsible-header" onclick="togglePanel('combineContainer', 'combineArrow')">
        <span>ترکیب با جستجوهای دیگر</span>
        <span id="combineArrow">▼</span>
      </div>
      <div id="combineContainer" class="collapsible-container" style="display: none;"></div>
    </div>
    
    <!-- بخش جدید OSINT -->
    <div id="osintWrapper">
        <div id="osintHeader" class="collapsible-header" onclick="togglePanel('osintContainer', 'osintArrow')">
          <span>ابزارهای جستجوی تخصصی (OSINT)</span>
          <span id="osintArrow">▼</span>
        </div>
        <div id="osintContainer" class="collapsible-container" style="display: none;">
          <div class="option-group">
            <h3>یافتن فایل‌ها و دایرکتوری‌های حساس</h3>
            <div class="combine-option"><label><input type="checkbox" value="dir_listing" onchange="toggleCombineInput(this)"> لیست دایرکتوری‌ها (Index of)</label><div class="combine-input"><input type="text" placeholder="عبارت مرتبط (اختیاری)"></div></div>
            <div class="combine-option"><label><input type="checkbox" value="log_files" onchange="toggleCombineInput(this)"> فایل‌های Log</label><div class="combine-input"><input type="text" placeholder="عبارت مرتبط (اختیاری)"></div></div>
            <div class="combine-option"><label><input type="checkbox" value="sql_files" onchange="toggleCombineInput(this)"> فایل‌های پایگاه داده (SQL)</label><div class="combine-input"><input type="text" placeholder="عبارت مرتبط (اختیاری)"></div></div>
            <div class="combine-option"><label><input type="checkbox" value="env_files" onchange="toggleCombineInput(this)"> فایل‌های تنظیمات (env)</label><div class="combine-input"><input type="text" placeholder="عبارت مرتبط (اختیاری)"></div></div>
          </div>
          <div class="option-group">
            <h3>جستجوی هدفمند</h3>
            <div class="combine-option"><label><input type="checkbox" value="login_pages" onchange="toggleCombineInput(this)"> یافتن صفحات ورود (Login)</label><div class="combine-input"><input type="text" placeholder="مرتبط با چه سایتی؟ (مثلا: site:example.com)"></div></div>
            <div class="combine-option"><label><input type="checkbox" value="social_media" onchange="toggleCombineInput(this)"> جستجو در شبکه‌های اجتماعی</label><div class="combine-input"><input type="text" placeholder="نام شخص یا شرکت"></div></div>
            <div class="combine-option"><label><input type="checkbox" value="subdomains" onchange="toggleCombineInput(this)"> یافتن ساب‌دامین‌ها</label><div class="combine-input"><input type="text" placeholder="آدرس سایت اصلی (example.com)"></div></div>
          </div>
          <div class="option-group">
            <h3>اپراتورهای پیشرفته گوگل</h3>
            <div class="combine-option"><label><input type="checkbox" value="related" onchange="toggleCombineInput(this)"> سایت‌های مرتبط (related:)</label><div class="combine-input"><input type="text" placeholder="آدرس سایت (example.com)"></div></div>
            <div class="combine-option"><label><input type="checkbox" value="cache" onchange="toggleCombineInput(this)"> نسخه ذخیره‌شده سایت (cache:)</label><div class="combine-input"><input type="text" placeholder="آدرس سایت (example.com)"></div></div>
          </div>
        </div>
      </div>

    <button id="searchButton">جستجو کن</button>
    
    <div id="historyContainer" class="history" style="display: none;">
      <h3>سوابق جستجو</h3>
      <div id="historyList"></div>
    </div>
  </div>
  
  <script>
    document.addEventListener("DOMContentLoaded", function() {
        // ... (کد مربوط به ساخت دینامیک گزینه‌های ترکیب، بدون تغییر باقی می‌ماند)
        const searchTypeSelect = document.getElementById("searchType");
        const combineContainer = document.getElementById("combineContainer");
        const options = Array.from(searchTypeSelect.options).filter(opt => opt.value && opt.value !== "simple");
        options.forEach(option => {
            if (option.value === 'scholar') return; // Scholar has special handling
            const div = document.createElement("div");
            div.className = "combine-option";
            let placeholder = `متن برای: ${option.textContent}`;
            if (option.value === 'site' || option.value === 'link') placeholder = "آدرس سایت (example.com)";
            if (option.value === 'domain') placeholder = "دامنه (.edu, .gov)";
            div.innerHTML = `<label><input type="checkbox" value="${option.value}" onchange="toggleCombineInput(this)"> ${option.textContent}</label><div class="combine-input"><input type="text" placeholder="${placeholder}"></div>`;
            combineContainer.appendChild(div);
        });
        const rangeDiv = document.createElement("div");
        rangeDiv.className = "combine-option";
        rangeDiv.innerHTML = `<label><input type="checkbox" value="range" onchange="toggleCombineInput(this)"> تعیین محدوده مقدار (..)</label><div class="combine-input"><input type="text" placeholder="عدد اول (مثلا: 2020)" style="margin-bottom:5px;"/><input type="text" placeholder="عدد دوم (مثلا: 2023)"/></div>`;
        combineContainer.appendChild(rangeDiv);
        updateHistory();
    });

    let searchHistory = JSON.parse(localStorage.getItem('searchHistory')) || [];

    function showSearchField() {
        const searchType = document.getElementById("searchType").value;
        const searchContainer = document.getElementById("searchContainer");
        const domainOptions = document.getElementById("domainOptions");
        searchContainer.style.display = 'block';
        domainOptions.style.display = (searchType === "domain") ? 'block' : 'none';
    }
    
    function togglePanel(containerId, arrowId) {
        const panel = document.getElementById(containerId);
        const arrow = document.getElementById(arrowId);
        const header = arrow.parentElement;
        if (panel.style.display === "none" || panel.style.display === "") {
            panel.style.display = "block";
            arrow.innerHTML = "▲";
            header.style.borderRadius = "8px 8px 0 0";
        } else {
            panel.style.display = "none";
            arrow.innerHTML = "▼";
            header.style.borderRadius = "8px";
        }
    }

    function toggleCombineInput(checkbox) {
        const combineInputDiv = checkbox.closest('.combine-option').querySelector(".combine-input");
        combineInputDiv.style.display = checkbox.checked ? "block" : "none";
        if (!checkbox.checked) {
            combineInputDiv.querySelectorAll("input[type='text']").forEach(input => input.value = "");
        }
    }

    function addExcludeField() {
        const container = document.getElementById("excludeFieldsContainer");
        const newField = document.createElement("div");
        newField.className = "exclude-field";
        newField.innerHTML = `<input type="text" class="excludeInput" placeholder="این کلمات جستجو نشوند..." /><button class="remove-button" onclick="this.parentElement.remove()">-</button>`;
        container.appendChild(newField);
    }
    
    function getQueryPart(type, query, query2 = "") {
        switch(type) {
            case "simple": return query;
            case "ppt": case "pdf": case "docx": case "xlsx": return `filetype:${type} ${query}`;
            case "exact": return `"${query}"`;
            case "title": return `intitle:"${query}"`;
            case "inurl": return `inurl:"${query}"`;
            case "site": return `site:${query}`;
            case "domain": return `site:*.${query}`;
            case "link": return `link:${query}`;
            case "define": return `define:${query}`;
            case "range": return `${query}..${query2}`;
            case "scholar": return query;
            // OSINT Operators
            case "dir_listing": return `intitle:"index of" ${query}`;
            case "log_files": return `filetype:log ${query}`;
            case "sql_files": return `filetype:sql ${query}`;
            case "env_files": return `filetype:env ${query}`;
            case "login_pages": return `intitle:login OR inurl:login ${query}`;
            case "social_media": return `"${query}" site:twitter.com OR site:linkedin.com OR site:facebook.com OR site:instagram.com`;
            case "subdomains": return `site:*.${query} -site:www.${query}`;
            case "related": return `related:${query}`;
            case "cache": return `cache:${query}`;
            default: return query;
        }
    }

    function handleSearchButton() {
        const searchType = document.getElementById("searchType").value;
        const mainQuery = document.getElementById("searchInput").value.trim();
        const domainValue = document.getElementById("domainInput").value.trim();

        if (!mainQuery && !document.querySelector('.combine-option input:checked')) {
            alert("لطفاً حداقل یک عبارت برای جستجو وارد کنید یا یک گزینه را فعال کنید.");
            return;
        }

        let queryParts = [];
        let isScholarSearch = false;
        let scholarQueries = [];

        if (mainQuery) {
            if (searchType === 'scholar') {
                isScholarSearch = true;
                scholarQueries.push(mainQuery);
            } else {
                 let mainPart = (searchType === 'domain') ? getQueryPart(searchType, domainValue) + " " + mainQuery : getQueryPart(searchType, mainQuery);
                 queryParts.push(mainPart);
            }
        }
        
        // Process all checked options from both containers
        document.querySelectorAll(".combine-option input[type='checkbox']:checked").forEach(checkbox => {
            const container = checkbox.closest('.combine-option');
            const inputs = container.querySelectorAll(".combine-input input[type='text']");
            const val1 = inputs[0] ? inputs[0].value.trim() : "";
            const val2 = inputs[1] ? inputs[1].value.trim() : "";
            
            if (val1 || checkbox.value === 'dir_listing') { // Allow empty query for dir_listing
                 queryParts.push(getQueryPart(checkbox.value, val1, val2));
            }
        });
        
        const excludeQueries = Array.from(document.querySelectorAll(".excludeInput")).map(i => i.value.trim()).filter(v => v).map(w => `-${w}`);
        const finalQuery = [...queryParts, ...excludeQueries].join(" ").trim();

        if (finalQuery) {
            searchHistory.unshift({ query: finalQuery, isScholar: isScholarSearch, scholarQuery: scholarQueries.join(" ") });
            if (searchHistory.length > 15) searchHistory.pop();
            localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
            updateHistory();

            window.open(`https://www.google.com/search?q=${encodeURIComponent(finalQuery)}`, "_blank");
        }
        
        if (isScholarSearch && scholarQueries.length > 0) {
            window.open(`https://scholar.google.com/scholar?q=${encodeURIComponent(scholarQueries.join(" "))}`, "_blank");
        }
        if (!finalQuery && !isScholarSearch) {
            alert("هیچ عبارتی برای جستجو مشخص نشده است.");
        }
    }
    
    function updateHistory() {
        const historyList = document.getElementById("historyList");
        const historyContainer = document.getElementById("historyContainer");
        historyList.innerHTML = '';
        searchHistory.forEach((item, index) => {
            const div = document.createElement("div");
            div.className = "history-item";
            const textSpan = document.createElement("span");
            textSpan.className = "history-item-text";
            textSpan.textContent = item.query || item.scholarQuery;
            textSpan.onclick = () => rerunSearch(item);
            const deleteButton = document.createElement("button");
            deleteButton.className = "delete-button";
            deleteButton.textContent = "حذف";
            deleteButton.onclick = (e) => { e.stopPropagation(); searchHistory.splice(index, 1); localStorage.setItem('searchHistory', JSON.stringify(searchHistory)); updateHistory(); };
            div.appendChild(textSpan);
            div.appendChild(deleteButton);
            historyList.appendChild(div);
        });
        historyContainer.style.display = searchHistory.length > 0 ? 'block' : 'none';
    }

    function rerunSearch(historyItem) {
        if (historyItem.query) {
             window.open(`https://www.google.com/search?q=${encodeURIComponent(historyItem.query)}`, "_blank");
        }
        if (historyItem.isScholar && historyItem.scholarQuery) {
            window.open(`https://scholar.google.com/scholar?q=${encodeURIComponent(historyItem.scholarQuery)}`, "_blank");
        }
    }

    document.getElementById("searchButton").onclick = handleSearchButton;
    showSearchField();
  </script>

</body>
</html>
