<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>جستجوی پیشرفته</title>
  <link rel="icon" type="image/png" sizes="40x40" href="https://tashacol.github.io/ir/Icon40.png">
  <link rel="manifest" href="https://tashacol.github.io/ir/serch.json">
  <meta name="apple-mobile-web-app-title" content="جستجو پیشرفته">
  <meta name="application-name" content="جستجو پیشرفته">
  <meta name="theme-color" content="#ffffff">
  <style type="text/css">
    /* ریست استایل */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      direction: rtl;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #e0f7fa, #ffffff);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    
    .container {
      background: #ffffff;
      border-radius: 12px;
      padding: 30px;
      max-width: 700px;
      width: 100%;
      box-shadow: 0 16px 32px rgba(0, 0, 0, 0.1);
      animation: fadeInUp 0.6s ease both;
      border: 1px solid #e0e0e0;
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    h1 {
      text-align: center;
      color: #333333;
      margin-bottom: 25px;
      font-size: 2.4rem;
      font-weight: 600;
    }
    
    /* استایل فیلدها و منوهای کشویی - تغییرات برای جذاب و مدرن شدن */
    select, input[type="text"] {
      font-size: 1.1rem;
      width: 100%;
      padding: 14px 16px;
      margin: 10px 0;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      outline: none;
      background: linear-gradient(135deg, #ffffff, #f9f9f9);
      text-align: right;
      transition: border-color 0.3s, box-shadow 0.3s, background 0.3s;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    select:focus, input[type="text"]:focus {
      border-color: #0072ff;
      background: #ffffff;
      box-shadow: 0 4px 12px rgba(0, 114, 255, 0.2);
    }
    
    select {
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24'%3E%3Cpath fill='%23777777' d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      background-size: 16px;
    }
    
    button {
      font-size: 1.1rem;
      width: 100%;
      padding: 14px;
      margin: 10px 0;
      border: none;
      border-radius: 8px;
      background: linear-gradient(90deg, #00c6ff, #0072ff);
      color: #ffffff;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s, box-shadow 0.3s;
    }
    
    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 16px rgba(0, 114, 255, 0.3);
      background: linear-gradient(90deg, #009ae6, #005bb5);
    }
    
    button:active {
      transform: translateY(0);
      box-shadow: 0 4px 8px rgba(0, 114, 255, 0.2);
    }
    
    .add-button, .delete-button {
      width: auto;
      padding: 10px 14px;
      font-size: 0.95rem;
    }
    
    .add-button {
      background: linear-gradient(90deg, #28a745, #218838);
      border-radius: 6px;
      margin-left: 10px;
    }
    
    .add-button:hover {
      background: linear-gradient(90deg, #218838, #1e7e34);
    }
    
    .delete-button {
      background: linear-gradient(90deg, #dc3545, #c82333);
      border-radius: 6px;
    }
    
    .delete-button:hover {
      background: linear-gradient(90deg, #c82333, #bd2130);
    }
    
    .search-field {
      display: none;
      margin-top: 20px;
      padding: 15px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      background: #fdfdfd;
      animation: fadeIn 0.5s ease both;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    #domainOptions {
      margin-top: 10px;
    }
    
    .history {
      margin-top: 30px;
      border-top: 1px solid #cccccc;
      padding-top: 20px;
    }
    
    .history h3 {
      color: #555;
      margin-bottom: 15px;
      font-size: 1.3rem;
    }
    
    .history-item {
      padding: 12px 16px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      margin: 8px 0;
      cursor: pointer;
      transition: background 0.3s, transform 0.3s, box-shadow 0.3s;
      background: #f9f9f9;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .history-item:hover {
      background: #e6f7ff;
      transform: translateX(5px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    /* استایل حالت ترکیب جستجو */
    #combineContainer {
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 15px;
      margin-top: 10px;
      background: #ffffff;
    }
    
    #combineContainer p {
      margin-bottom: 10px;
      font-weight: 600;
      color: #333333;
    }
    
    #combineContainer .combine-option {
      margin-bottom: 10px;
    }
    
    #combineContainer .combine-option label {
      cursor: pointer;
      font-size: 1rem;
      color: #444444;
    }
    
    #combineContainer .combine-input {
      margin-top: 5px;
      display: none;
    }
    
    /* استایل برای قسمت ترکیب جستجو به صورت کشویی */
    #combineHeader {
      cursor: pointer;
      font-weight: 600;
      margin-top: 10px;
      padding: 10px;
      background: #f0f0f0;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>جستجوی پیشرفته</h1>
    <!-- حالت جستجوی تک نوع -->
    <p id="singleSelectContainer">
      <select id="searchType" onchange="showSearchField()">
        <option value="">نوع جستجو را انتخاب کنید</option>
        <option value="simple">جستجوی ساده</option>
        <option value="ppt">جستجوی پاورپوینت</option>
        <option value="pdf">جستجوی پی دی اف</option>
        <option value="docx">جستجوی ورد</option>
        <option value="xlsx">جستجوی اکسل</option>
        <option value="txt">جستجوی TXT</option>
        <option value="exact">جستجوی دقیق مطلب</option>
        <option value="title">جستجو در تیترها</option>
        <option value="inurl">جستجو در لینک صفحه</option>
        <option value="link">جستجو صفحاتی که به یک صفحه خاص لینک داده‌اند</option>
        <option value="inmeta">جستجو در متاها</option>
        <option value="infographic_fa">جستجوی اینفوگرافیک فارسی</option>
        <option value="infographic_en">جستجوی اینفوگرافیک انگلیسی</option>
        <option value="isbn">جستجوی مربوط به کتب (ISBN)</option>
        <option value="issn">جستجوی مربوط به مقالات (ISSN)</option>
        <option value="site">جستجو در سایت خاص</option>
        <option value="define">جستجوی معنا و توضیح</option>
        <option value="scholar">جستجو در گوگل محقق</option>
        <option value="domain">جستجوی دامنه خاص</option>
      </select>
    </p>
    <div id="domainOptions" style="display:none;">
      <select id="domainSelect" onchange="setDomainSearch()">
        <option value="">دامنه را انتخاب کنید</option>
        <option value=".edu">.edu</option>
        <option value=".gov">.gov</option>
        <option value=".ac">.ac</option>
      </select>
    </div>
    <div id="searchContainer" class="search-field">
      <input type="text" id="searchInput" placeholder="جستجو..." />
      <div id="excludeFieldsContainer">
        <div class="exclude-field">
          <input type="text" class="excludeInput" placeholder="این کلمات جستجو نشوند..." />
          <button class="add-button" onclick="addExcludeField()">+</button>
        </div>
      </div>
    </div>
    <!-- بخش ترکیب جستجو به صورت کشویی -->
    <div id="combineWrapper">
      <div id="combineHeader" onclick="toggleCombinePanel()">ترکیب چند نوع جستجو &#9660;</div>
      <div id="combineContainer" style="display: none;">
        <p>ترکیب چند نوع جستجو</p>
        <div class="combine-option">
          <label>
            <input type="checkbox" value="ppt" class="combineOption" onchange="toggleCombineInput(this)"> جستجوی پاورپوینت
          </label>
          <div class="combine-input">
            <input type="text" placeholder="متن جستجو برای جستجوی پاورپوینت" />
          </div>
        </div>
        <div class="combine-option">
          <label>
            <input type="checkbox" value="pdf" class="combineOption" onchange="toggleCombineInput(this)"> جستجوی پی دی اف
          </label>
          <div class="combine-input">
            <input type="text" placeholder="متن جستجو برای جستجوی پی دی اف" />
          </div>
        </div>
        <div class="combine-option">
          <label>
            <input type="checkbox" value="docx" class="combineOption" onchange="toggleCombineInput(this)"> جستجوی ورد
          </label>
          <div class="combine-input">
            <input type="text" placeholder="متن جستجو برای جستجوی ورد" />
          </div>
        </div>
        <div class="combine-option">
          <label>
            <input type="checkbox" value="xlsx" class="combineOption" onchange="toggleCombineInput(this)"> جستجوی اکسل
          </label>
          <div class="combine-input">
            <input type="text" placeholder="متن جستجو برای جستجوی اکسل" />
          </div>
        </div>
        <div class="combine-option">
          <label>
            <input type="checkbox" value="txt" class="combineOption" onchange="toggleCombineInput(this)"> جستجوی TXT
          </label>
          <div class="combine-input">
            <input type="text" placeholder="متن جستجو برای جستجوی TXT" />
          </div>
        </div>
        <div class="combine-option">
          <label>
            <input type="checkbox" value="exact" class="combineOption" onchange="toggleCombineInput(this)"> جستجوی دقیق مطلب
          </label>
          <div class="combine-input">
            <input type="text" placeholder="متن جستجو برای جستجوی دقیق مطلب" />
          </div>
        </div>
        <div class="combine-option">
          <label>
            <input type="checkbox" value="title" class="combineOption" onchange="toggleCombineInput(this)"> جستجو در تیترها
          </label>
          <div class="combine-input">
            <input type="text" placeholder="متن جستجو برای جستجو در تیترها" />
          </div>
        </div>
        <div class="combine-option">
          <label>
            <input type="checkbox" value="inurl" class="combineOption" onchange="toggleCombineInput(this)"> جستجو در لینک صفحه
          </label>
          <div class="combine-input">
            <input type="text" placeholder="متن جستجو برای جستجو در لینک صفحه" />
          </div>
        </div>
        <div class="combine-option">
          <label>
            <input type="checkbox" value="link" class="combineOption" onchange="toggleCombineInput(this)"> جستجو صفحاتی که به یک صفحه خاص لینک داده‌اند
          </label>
          <div class="combine-input">
            <input type="text" placeholder="متن جستجو برای جستجو صفحاتی که به یک صفحه خاص لینک داده‌اند" />
          </div>
        </div>
        <div class="combine-option">
          <label>
            <input type="checkbox" value="inmeta" class="combineOption" onchange="toggleCombineInput(this)"> جستجو در متاها
          </label>
          <div class="combine-input">
            <input type="text" placeholder="متن جستجو برای جستجو در متاها" />
          </div>
        </div>
        <div class="combine-option">
          <label>
            <input type="checkbox" value="infographic_fa" class="combineOption" onchange="toggleCombineInput(this)"> جستجوی اینفوگرافیک فارسی
          </label>
          <div class="combine-input">
            <input type="text" placeholder="متن جستجو برای جستجوی اینفوگرافیک فارسی" />
          </div>
        </div>
        <div class="combine-option">
          <label>
            <input type="checkbox" value="infographic_en" class="combineOption" onchange="toggleCombineInput(this)"> جستجوی اینفوگرافیک انگلیسی
          </label>
          <div class="combine-input">
            <input type="text" placeholder="متن جستجو برای جستجوی اینفوگرافیک انگلیسی" />
          </div>
        </div>
        <div class="combine-option">
          <label>
            <input type="checkbox" value="isbn" class="combineOption" onchange="toggleCombineInput(this)"> جستجوی مربوط به کتب (ISBN)
          </label>
          <div class="combine-input">
            <input type="text" placeholder="متن جستجو برای جستجوی مربوط به کتب (ISBN)" />
          </div>
        </div>
        <div class="combine-option">
          <label>
            <input type="checkbox" value="issn" class="combineOption" onchange="toggleCombineInput(this)"> جستجوی مربوط به مقالات (ISSN)
          </label>
          <div class="combine-input">
            <input type="text" placeholder="متن جستجو برای جستجوی مربوط به مقالات (ISSN)" />
          </div>
        </div>
        <div class="combine-option">
          <label>
            <input type="checkbox" value="site" class="combineOption" onchange="toggleCombineInput(this)"> جستجو در سایت خاص
          </label>
          <div class="combine-input">
            <input type="text" placeholder="نام سایت (مثلاً example.com)" />
          </div>
        </div>
        <div class="combine-option">
          <label>
            <input type="checkbox" value="define" class="combineOption" onchange="toggleCombineInput(this)"> جستجوی معنا و توضیح
          </label>
          <div class="combine-input">
            <input type="text" placeholder="متن جستجو برای جستجوی معنا و توضیح" />
          </div>
        </div>
        <div class="combine-option">
          <label>
            <input type="checkbox" value="scholar" class="combineOption" onchange="toggleCombineInput(this)"> جستجو در گوگل محقق
          </label>
          <div class="combine-input">
            <input type="text" placeholder="متن جستجو برای جستجو در گوگل محقق" />
          </div>
        </div>
        <div class="combine-option">
          <label>
            <input type="checkbox" value="domain" class="combineOption" onchange="toggleCombineInput(this)"> جستجوی دامنه خاص
          </label>
          <div class="combine-input">
            <input type="text" placeholder="دامنه (مثلاً .edu, .gov, .ac)" />
          </div>
        </div>
        <!-- گزینه جدید: تعیین محدوده مقدار -->
        <div class="combine-option">
          <label>
            <input type="checkbox" value="range" class="combineOption" onchange="toggleCombineInput(this)"> تعیین محدوده مقدار
          </label>
          <div class="combine-input">
            <input type="text" placeholder="عدد اول" style="margin-bottom:5px;" />
            <input type="text" placeholder="عدد دوم" />
          </div>
        </div>
      </div>
    </div>
    <!-- دکمه جستجو در انتها قرار می‌گیرد -->
    <button id="searchButton">جستجو</button>
    <div id="historyContainer" class="history" style="display: none;">
      <h3>سوابق جستجو:</h3>
      <div id="historyList">&nbsp;</div>
    </div>
  </div>
  
  <script>
    var searchHistory = JSON.parse(localStorage.getItem('searchHistory')) || [];
    
    function showSearchField() {
      var searchType = document.getElementById("searchType").value;
      var searchContainer = document.getElementById("searchContainer");
      var domainOptions = document.getElementById("domainOptions");
  
      searchContainer.style.display = searchType ? 'block' : 'none';
      domainOptions.style.display = (searchType === "domain") ? 'block' : 'none';
      document.getElementById("searchInput").placeholder = "جستجوی " + (searchType ? searchType.toUpperCase() : "");
      // حذف تغییر خودکار نمایش قسمت ترکیب، زیرا اکنون به صورت کشویی کنترل می‌شود.
    }
    
    function toggleCombinePanel() {
      var panel = document.getElementById("combineContainer");
      var header = document.getElementById("combineHeader");
      if (panel.style.display === "none" || panel.style.display === "") {
        panel.style.display = "block";
        header.innerHTML = "ترکیب چند نوع جستجو &#9650;";
      } else {
        panel.style.display = "none";
        header.innerHTML = "ترکیب چند نوع جستجو &#9660;";
      }
    }
    
    function addExcludeField() {
      var excludeFieldsContainer = document.getElementById("excludeFieldsContainer");
      var newExcludeField = document.createElement("div");
      newExcludeField.className = "exclude-field";
      newExcludeField.innerHTML = `
        <input type="text" class="excludeInput" placeholder="این کلمات جستجو نشوند..." />
        <button class="add-button" onclick="removeExcludeField(this)">-</button>
      `;
      excludeFieldsContainer.appendChild(newExcludeField);
    }
    
    function removeExcludeField(button) {
      button.parentElement.remove();
    }
    
    function getQueryPart(type, query) {
      switch(type) {
        case "simple":
          return query;
        case "ppt":
          return "filetype:ppt " + query;
        case "pdf":
          return "filetype:pdf " + query;
        case "docx":
          return "filetype:docx " + query;
        case "xlsx":
          return "filetype:xlsx " + query;
        case "txt":
          return "filetype:txt " + query;
        case "exact":
          return '"' + query + '"';
        case "title":
          return 'intitle:"' + query + '"';
        case "inurl":
          return 'inurl:"' + query + '"';
        case "link":
          return "link:" + query;
        case "inmeta":
          return 'inmeta:"' + query + '"';
        case "infographic_fa":
          return query + " اینفوگرافی";
        case "infographic_en":
          return query + " Infographic";
        case "isbn":
          return "ISBN:" + query;
        case "issn":
          return "ISSN:" + query;
        case "site":
          return "site:" + query;
        case "define":
          return "define:" + query;
        case "domain":
          return "site:" + query;
        case "scholar":
          return "";
        case "range":
          return "";
        default:
          return query;
      }
    }
    
    function performSearch(searchType, query, excludeQueries, domain) {
      var finalQuery = query;
      if (excludeQueries.length > 0) {
        finalQuery = '"' + query + '" ' + excludeQueries.map(function(word) {
          return '-' + word;
        }).join(' ');
      }
  
      if (searchType === "simple") {
        var searchURL = "https://www.google.com/search?q=" + encodeURIComponent(finalQuery);
        window.open(searchURL, "_blank");
      } else if (searchType === "ppt") {
        search('ppt', finalQuery);
      } else if (searchType === "pdf") {
        search('pdf', finalQuery);
      } else if (searchType === "docx") {
        search('docx', finalQuery);
      } else if (searchType === "xlsx") {
        search('xlsx', finalQuery);
      } else if (searchType === "txt") {
        search('txt', finalQuery);
      } else if (searchType === "exact") {
        searchExact(finalQuery);
      } else if (searchType === "title") {
        searchAllInTitle(finalQuery);
      } else if (searchType === "inurl") {
        searchInUrl(finalQuery);
      } else if (searchType === "link") {
        searchLink(finalQuery);
      } else if (searchType === "inmeta") {
        searchInMeta(finalQuery);
      } else if (searchType === "infographic_fa") {
        searchInfographicFa(finalQuery);
      } else if (searchType === "infographic_en") {
        searchInfographicEn(finalQuery);
      } else if (searchType === "isbn") {
        searchISBN(finalQuery);
      } else if (searchType === "issn") {
        searchISSN(finalQuery);
      } else if (searchType === "site") {
        searchInSite(finalQuery);
      } else if (searchType === "define") {
        searchDefine(finalQuery);
      } else if (searchType === "scholar") {
        searchScholar(finalQuery);
      } else if (searchType === "domain") {
        searchDomain(finalQuery, domain);
      }
    }
    
    function search(fileType, query) {
      var searchQuery = "filetype:" + fileType + " " + query;
      var searchURL = "https://www.google.com/search?q=" + encodeURIComponent(searchQuery);
      window.open(searchURL, "_blank");
    }
    
    function searchInSite(query) {
      var site = prompt("نام سایت (مثلاً example.com) را وارد کنید:");
      if (site) {
        var searchURL = "https://www.google.com/search?q=" + encodeURIComponent(query + " site:" + site);
        window.open(searchURL, "_blank");
      }
    }
    
    function searchExact(query) {
      var searchURL = "https://www.google.com/search?q=" + encodeURIComponent('"' + query + '"');
      window.open(searchURL, "_blank");
    }
    
    function searchAllInTitle(query) {
      var searchURL = "https://www.google.com/search?q=" + encodeURIComponent('intitle:"' + query + '"');
      window.open(searchURL, "_blank");
    }
    
    function searchInUrl(query) {
      var searchURL = "https://www.google.com/search?q=" + encodeURIComponent('inurl:"' + query + '"');
      window.open(searchURL, "_blank");
    }
    
    function searchLink(query) {
      var searchURL = "https://www.google.com/search?q=" + encodeURIComponent("link:" + query);
      window.open(searchURL, "_blank");
    }
    
    function searchInMeta(query) {
      var searchURL = "https://www.google.com/search?q=" + encodeURIComponent('inmeta:"' + query + '"');
      window.open(searchURL, "_blank");
    }
    
    function searchInfographicFa(query) {
      var searchURL = "https://www.google.com/search?q=" + encodeURIComponent(query + " اینفوگرافی");
      window.open(searchURL, "_blank");
    }
    
    function searchInfographicEn(query) {
      var searchURL = "https://www.google.com/search?q=" + encodeURIComponent(query + " Infographic");
      window.open(searchURL, "_blank");
    }
    
    function searchISBN(query) {
      var searchURL = "https://www.google.com/search?q=" + encodeURIComponent("ISBN:" + query);
      window.open(searchURL, "_blank");
    }
    
    function searchISSN(query) {
      var searchURL = "https://www.google.com/search?q=" + encodeURIComponent("ISSN:" + query);
      window.open(searchURL, "_blank");
    }
    
    function searchDefine(query) {
      var searchURL = "https://www.google.com/search?q=" + encodeURIComponent("define:" + query);
      window.open(searchURL, "_blank");
    }
    
    function searchScholar(query) {
      var googleScholarUrl = 'https://scholar.google.com/scholar?q=' + encodeURIComponent(query);
      window.open(googleScholarUrl, '_blank');
    }
    
    function searchDomain(query, domain) {
      var searchQuery = "site:" + domain + " " + query;
      var searchURL = "https://www.google.com/search?q=" + encodeURIComponent(searchQuery);
      window.open(searchURL, "_blank");
    }
    
    function setDomainSearch() {
      // در صورت نیاز می‌توانید کدهای دلخواه خود را اضافه کنید.
    }
    
    function toggleCombineInput(checkbox) {
      var combineInputDiv = checkbox.parentElement.parentElement.querySelector(".combine-input");
      if(checkbox.checked) {
        combineInputDiv.style.display = "block";
      } else {
        combineInputDiv.style.display = "none";
        var inputs = combineInputDiv.querySelectorAll("input[type='text']");
        inputs.forEach(function(input) {
          input.value = "";
        });
      }
    }
    
    function handleSearchButton() {
      var mainQuery = document.getElementById("searchInput").value.trim();
      var excludeQueries = [];
      var excludeFields = document.querySelectorAll(".excludeInput");
      excludeFields.forEach(function(field) {
        if (field.value.trim()) {
          excludeQueries.push(field.value.trim());
        }
      });
      // بررسی کنید که آیا گزینه‌های ترکیبی انتخاب شده‌اند
      var combinedOptions = document.querySelectorAll("#combineContainer .combineOption:checked");
      if(mainQuery && combinedOptions.length > 0) {
        performCombinedSearch(excludeQueries);
      } else {
        var searchType = document.getElementById("searchType").value;
        var domain = document.getElementById("domainSelect").value;
        if (searchType === "domain" && domain === "") {
          alert("لطفاً دامنه را انتخاب کنید.");
          return;
        }
        searchHistory.unshift({ type: searchType, query: mainQuery, excludeQueries: excludeQueries, domain: domain });
        localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
        performSearch(searchType, mainQuery, excludeQueries, domain);
      }
    }
    
    function performCombinedSearch(excludeQueries) {
      var finalQueryParts = [];
      var scholarSelected = false;
      var mainType = document.getElementById("searchType").value;
      var mainQuery = document.getElementById("searchInput").value.trim();
      if(mainQuery) {
        finalQueryParts.push(getQueryPart(mainType, mainQuery));
        if(mainType === "scholar") {
          scholarSelected = true;
        }
      }
      
      var combinedDivs = document.querySelectorAll("#combineContainer .combine-option");
      combinedDivs.forEach(function(div) {
        var checkbox = div.querySelector(".combineOption");
        if(checkbox && checkbox.checked) {
          if(checkbox.value === "range") {
            var inputs = div.querySelectorAll(".combine-input input[type='text']");
            if(inputs.length >= 2) {
              var value1 = inputs[0].value.trim();
              var value2 = inputs[1].value.trim();
              if(value1 && value2) {
                finalQueryParts.push(value1 + ".." + value2);
              }
            }
          } else {
            var inputField = div.querySelector(".combine-input input[type='text']");
            var value = inputField.value.trim();
            if(value) {
              finalQueryParts.push(getQueryPart(checkbox.value, value));
              if(checkbox.value === "scholar") {
                scholarSelected = true;
              }
            }
          }
        }
      });
      
      if (excludeQueries.length > 0) {
        finalQueryParts.push(excludeQueries.map(function(word) {
          return '-' + word;
        }).join(' '));
      }
      
      var finalQuery = finalQueryParts.join(" ");
      searchHistory.unshift({ type: "combined", query: finalQuery, excludeQueries: excludeQueries });
      localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
      
      var searchURL = "https://www.google.com/search?q=" + encodeURIComponent(finalQuery);
      window.open(searchURL, "_blank");
      
      if (scholarSelected) {
        var scholarURL = "https://scholar.google.com/scholar?q=" + encodeURIComponent(mainQuery);
        window.open(scholarURL, "_blank");
      }
    }
    
    function updateHistory() {
      var historyList = document.getElementById("historyList");
      historyList.innerHTML = '';
      searchHistory.forEach(function(item, index) {
        var div = document.createElement("div");
        div.className = "history-item";
        div.innerText = item.query + " (" + item.type + ")";
        div.onclick = function() {
          if(item.type === "combined") {
            var searchURL = "https://www.google.com/search?q=" + encodeURIComponent(item.query);
            window.open(searchURL, "_blank");
          } else {
            performSearch(item.type, item.query, item.excludeQueries, item.domain);
          }
        };
  
        var deleteButton = document.createElement("button");
        deleteButton.className = "delete-button";
        deleteButton.innerText = "حذف";
        deleteButton.onclick = function(event) {
          event.stopPropagation();
          searchHistory.splice(index, 1);
          localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
          updateHistory();
        };
  
        div.appendChild(deleteButton);
        historyList.appendChild(div);
      });
  
      document.getElementById("historyContainer").style.display = searchHistory.length > 0 ? 'block' : 'none';
    }
    
    document.getElementById("searchButton").onclick = handleSearchButton;
    
    updateHistory();
  </script>
</body>
</html>
